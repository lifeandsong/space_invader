<!-- saved from url=(0045)file:///Users/lifeandsong/space_invaders.html -->
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <meta name="color-scheme" content="light dark">
   </head>
   <body>
      <div class="line-gutter-backdrop"></div>
      <form autocomplete="off"><label class="line-wrap-control">자동 줄바꿈<input type="checkbox" aria-label="자동 줄바꿈"></label></form>
      <table>
         <tbody>
            <tr>
               <td class="line-number" value="1"></td>
               <td class="line-content"><span class="html-doctype">&lt;!DOCTYPE html&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="2"></td>
               <td class="line-content"><span class="html-tag">&lt;html <span class="html-attribute-name">lang</span>="<span class="html-attribute-value">en</span>"&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="3"></td>
               <td class="line-content"><span class="html-tag">&lt;head&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="4"></td>
               <td class="line-content">    <span class="html-tag">&lt;meta <span class="html-attribute-name">charset</span>="<span class="html-attribute-value">UTF-8</span>"&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="5"></td>
               <td class="line-content">    <span class="html-tag">&lt;meta <span class="html-attribute-name">name</span>="<span class="html-attribute-value">viewport</span>" <span class="html-attribute-name">content</span>="<span class="html-attribute-value">width=device-width, initial-scale=1.0</span>"&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="6"></td>
               <td class="line-content">    <span class="html-tag">&lt;title&gt;</span>Space Invaders<span class="html-tag">&lt;/title&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="7"></td>
               <td class="line-content">    <span class="html-tag">&lt;style&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="8"></td>
               <td class="line-content">        body {</td>
            </tr>
            <tr>
               <td class="line-number" value="9"></td>
               <td class="line-content">            margin: 0;</td>
            </tr>
            <tr>
               <td class="line-number" value="10"></td>
               <td class="line-content">            padding: 0;</td>
            </tr>
            <tr>
               <td class="line-number" value="11"></td>
               <td class="line-content">            background: #000;</td>
            </tr>
            <tr>
               <td class="line-number" value="12"></td>
               <td class="line-content">            display: flex;</td>
            </tr>
            <tr>
               <td class="line-number" value="13"></td>
               <td class="line-content">            justify-content: center;</td>
            </tr>
            <tr>
               <td class="line-number" value="14"></td>
               <td class="line-content">            align-items: center;</td>
            </tr>
            <tr>
               <td class="line-number" value="15"></td>
               <td class="line-content">            min-height: 100vh;</td>
            </tr>
            <tr>
               <td class="line-number" value="16"></td>
               <td class="line-content">            font-family: 'Courier New', monospace;</td>
            </tr>
            <tr>
               <td class="line-number" value="17"></td>
               <td class="line-content">            color: #00ff00;</td>
            </tr>
            <tr>
               <td class="line-number" value="18"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="19"></td>
               <td class="line-content">        </td>
            </tr>
            <tr>
               <td class="line-number" value="20"></td>
               <td class="line-content">        #gameContainer {</td>
            </tr>
            <tr>
               <td class="line-number" value="21"></td>
               <td class="line-content">            text-align: center;</td>
            </tr>
            <tr>
               <td class="line-number" value="22"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="23"></td>
               <td class="line-content">        </td>
            </tr>
            <tr>
               <td class="line-number" value="24"></td>
               <td class="line-content">        canvas {</td>
            </tr>
            <tr>
               <td class="line-number" value="25"></td>
               <td class="line-content">            border: 2px solid #00ff00;</td>
            </tr>
            <tr>
               <td class="line-number" value="26"></td>
               <td class="line-content">            background: #000;</td>
            </tr>
            <tr>
               <td class="line-number" value="27"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="28"></td>
               <td class="line-content">        </td>
            </tr>
            <tr>
               <td class="line-number" value="29"></td>
               <td class="line-content">        #score {</td>
            </tr>
            <tr>
               <td class="line-number" value="30"></td>
               <td class="line-content">            font-size: 24px;</td>
            </tr>
            <tr>
               <td class="line-number" value="31"></td>
               <td class="line-content">            margin-bottom: 10px;</td>
            </tr>
            <tr>
               <td class="line-number" value="32"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="33"></td>
               <td class="line-content">        </td>
            </tr>
            <tr>
               <td class="line-number" value="34"></td>
               <td class="line-content">        #gameOver {</td>
            </tr>
            <tr>
               <td class="line-number" value="35"></td>
               <td class="line-content">            font-size: 32px;</td>
            </tr>
            <tr>
               <td class="line-number" value="36"></td>
               <td class="line-content">            color: #ff0000;</td>
            </tr>
            <tr>
               <td class="line-number" value="37"></td>
               <td class="line-content">            margin-top: 20px;</td>
            </tr>
            <tr>
               <td class="line-number" value="38"></td>
               <td class="line-content">            display: none;</td>
            </tr>
            <tr>
               <td class="line-number" value="39"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="40"></td>
               <td class="line-content">        </td>
            </tr>
            <tr>
               <td class="line-number" value="41"></td>
               <td class="line-content">        #instructions {</td>
            </tr>
            <tr>
               <td class="line-number" value="42"></td>
               <td class="line-content">            margin-top: 20px;</td>
            </tr>
            <tr>
               <td class="line-number" value="43"></td>
               <td class="line-content">            font-size: 14px;</td>
            </tr>
            <tr>
               <td class="line-number" value="44"></td>
               <td class="line-content">            color: #888;</td>
            </tr>
            <tr>
               <td class="line-number" value="45"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="46"></td>
               <td class="line-content">    <span class="html-tag">&lt;/style&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="47"></td>
               <td class="line-content"><span class="html-tag">&lt;/head&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="48"></td>
               <td class="line-content"><span class="html-tag">&lt;body&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="49"></td>
               <td class="line-content">    <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">gameContainer</span>"&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="50"></td>
               <td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">score</span>"&gt;</span>Score: 0 | Stage: 1 | Lives: 3<span class="html-tag">&lt;/div&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="51"></td>
               <td class="line-content">        <span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>="<span class="html-attribute-value">gameCanvas</span>" <span class="html-attribute-name">width</span>="<span class="html-attribute-value">800</span>" <span class="html-attribute-name">height</span>="<span class="html-attribute-value">600</span>"&gt;</span><span class="html-tag">&lt;/canvas&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="52"></td>
               <td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">gameOver</span>"&gt;</span>GAME OVER<span class="html-tag">&lt;br&gt;</span>Press R to Restart<span class="html-tag">&lt;/div&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="53"></td>
               <td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">gameComplete</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size: 32px; color: #00ff00; margin-top: 20px; display: none;</span>"&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="54"></td>
               <td class="line-content">            CONGRATULATIONS!<span class="html-tag">&lt;br&gt;</span>YOU SAVED THE GALAXY!<span class="html-tag">&lt;br&gt;</span>Press R to Play Again</td>
            </tr>
            <tr>
               <td class="line-number" value="55"></td>
               <td class="line-content">        <span class="html-tag">&lt;/div&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="56"></td>
               <td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">newRecord</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size: 24px; color: #ffff00; margin-top: 20px; display: none;</span>"&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="57"></td>
               <td class="line-content">            NEW HIGH SCORE!<span class="html-tag">&lt;br&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="58"></td>
               <td class="line-content">            Enter your name (max 10 chars):<span class="html-tag">&lt;br&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="59"></td>
               <td class="line-content">            <span class="html-tag">&lt;input <span class="html-attribute-name">type</span>="<span class="html-attribute-value">text</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">playerName</span>" <span class="html-attribute-name">maxlength</span>="<span class="html-attribute-value">10</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size: 20px; text-align: center; margin: 10px;</span>"&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="60"></td>
               <td class="line-content">            <span class="html-tag">&lt;br&gt;</span><span class="html-tag">&lt;button <span class="html-attribute-name">id</span>="<span class="html-attribute-value">submitScore</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size: 16px; padding: 5px 15px;</span>"&gt;</span>Submit<span class="html-tag">&lt;/button&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="61"></td>
               <td class="line-content">        <span class="html-tag">&lt;/div&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="62"></td>
               <td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">rankings</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size: 18px; color: #00ffff; margin-top: 20px;</span>"&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="63"></td>
               <td class="line-content">            <span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size: 24px; margin-bottom: 10px;</span>"&gt;</span>🏆 HIGH SCORES 🏆<span class="html-tag">&lt;/div&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="64"></td>
               <td class="line-content">            <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">rankingList</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="65"></td>
               <td class="line-content">        <span class="html-tag">&lt;/div&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="66"></td>
               <td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">instructions</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top: 20px; font-size: 14px; color: #888;</span>"&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="67"></td>
               <td class="line-content">            Use ARROW KEYS to move • SPACEBAR to shoot • R to restart</td>
            </tr>
            <tr>
               <td class="line-number" value="68"></td>
               <td class="line-content">        <span class="html-tag">&lt;/div&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="69"></td>
               <td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">startScreen</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size: 24px; color: #00ff00; margin-top: 20px;</span>"&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="70"></td>
               <td class="line-content">            SPACE INVADERS<span class="html-tag">&lt;br&gt;</span><span class="html-tag">&lt;br&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="71"></td>
               <td class="line-content">            Press R to Start Game</td>
            </tr>
            <tr>
               <td class="line-number" value="72"></td>
               <td class="line-content">        <span class="html-tag">&lt;/div&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="73"></td>
               <td class="line-content">    <span class="html-tag">&lt;/div&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="74"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="75"></td>
               <td class="line-content">    <span class="html-tag">&lt;script&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="76"></td>
               <td class="line-content">        // Game canvas and context</td>
            </tr>
            <tr>
               <td class="line-number" value="77"></td>
               <td class="line-content">        const canvas = document.getElementById('gameCanvas');</td>
            </tr>
            <tr>
               <td class="line-number" value="78"></td>
               <td class="line-content">        const ctx = canvas.getContext('2d');</td>
            </tr>
            <tr>
               <td class="line-number" value="79"></td>
               <td class="line-content">        const scoreElement = document.getElementById('score');</td>
            </tr>
            <tr>
               <td class="line-number" value="80"></td>
               <td class="line-content">        const gameOverElement = document.getElementById('gameOver');</td>
            </tr>
            <tr>
               <td class="line-number" value="81"></td>
               <td class="line-content">        const gameCompleteElement = document.getElementById('gameComplete');</td>
            </tr>
            <tr>
               <td class="line-number" value="82"></td>
               <td class="line-content">        const startScreenElement = document.getElementById('startScreen');</td>
            </tr>
            <tr>
               <td class="line-number" value="83"></td>
               <td class="line-content">        const newRecordElement = document.getElementById('newRecord');</td>
            </tr>
            <tr>
               <td class="line-number" value="84"></td>
               <td class="line-content">        const playerNameInput = document.getElementById('playerName');</td>
            </tr>
            <tr>
               <td class="line-number" value="85"></td>
               <td class="line-content">        const submitScoreButton = document.getElementById('submitScore');</td>
            </tr>
            <tr>
               <td class="line-number" value="86"></td>
               <td class="line-content">        const rankingListElement = document.getElementById('rankingList');</td>
            </tr>
            <tr>
               <td class="line-number" value="87"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="88"></td>
               <td class="line-content">        // Game state</td>
            </tr>
            <tr>
               <td class="line-number" value="89"></td>
               <td class="line-content">        let gameRunning = false; // Start with game not running</td>
            </tr>
            <tr>
               <td class="line-number" value="90"></td>
               <td class="line-content">        let gameStarted = false; // Track if game has started</td>
            </tr>
            <tr>
               <td class="line-number" value="91"></td>
               <td class="line-content">        let score = 0;</td>
            </tr>
            <tr>
               <td class="line-number" value="92"></td>
               <td class="line-content">        let keys = {};</td>
            </tr>
            <tr>
               <td class="line-number" value="93"></td>
               <td class="line-content">        let ufoSpawnTimer = Math.random() * 1000 + 500; // Random spawn time</td>
            </tr>
            <tr>
               <td class="line-number" value="94"></td>
               <td class="line-content">        let currentStage = 1;</td>
            </tr>
            <tr>
               <td class="line-number" value="95"></td>
               <td class="line-content">        let isGameComplete = false;</td>
            </tr>
            <tr>
               <td class="line-number" value="96"></td>
               <td class="line-content">        let playerLives = 3;</td>
            </tr>
            <tr>
               <td class="line-number" value="97"></td>
               <td class="line-content">        let invulnerabilityTimer = 0;</td>
            </tr>
            <tr>
               <td class="line-number" value="98"></td>
               <td class="line-content">        let previewStage = Math.floor(Math.random() * 4) + 1; // Random stage 1-4 for preview</td>
            </tr>
            <tr>
               <td class="line-number" value="99"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="100"></td>
               <td class="line-content">        // Audio context for sound effects</td>
            </tr>
            <tr>
               <td class="line-number" value="101"></td>
               <td class="line-content">        let audioContext;</td>
            </tr>
            <tr>
               <td class="line-number" value="102"></td>
               <td class="line-content">        let ufoSoundInterval;</td>
            </tr>
            <tr>
               <td class="line-number" value="103"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="104"></td>
               <td class="line-content">        // Ranking system</td>
            </tr>
            <tr>
               <td class="line-number" value="105"></td>
               <td class="line-content">        let rankings = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="106"></td>
               <td class="line-content">        let isNewRecord = false;</td>
            </tr>
            <tr>
               <td class="line-number" value="107"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="108"></td>
               <td class="line-content">        // Player object</td>
            </tr>
            <tr>
               <td class="line-number" value="109"></td>
               <td class="line-content">        const player = {</td>
            </tr>
            <tr>
               <td class="line-number" value="110"></td>
               <td class="line-content">            x: canvas.width / 2 - 25,</td>
            </tr>
            <tr>
               <td class="line-number" value="111"></td>
               <td class="line-content">            y: canvas.height - 60,</td>
            </tr>
            <tr>
               <td class="line-number" value="112"></td>
               <td class="line-content">            width: 50,</td>
            </tr>
            <tr>
               <td class="line-number" value="113"></td>
               <td class="line-content">            height: 30,</td>
            </tr>
            <tr>
               <td class="line-number" value="114"></td>
               <td class="line-content">            speed: 5,</td>
            </tr>
            <tr>
               <td class="line-number" value="115"></td>
               <td class="line-content">            color: '#00ff00'</td>
            </tr>
            <tr>
               <td class="line-number" value="116"></td>
               <td class="line-content">        };</td>
            </tr>
            <tr>
               <td class="line-number" value="117"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="118"></td>
               <td class="line-content">        // Arrays for game objects</td>
            </tr>
            <tr>
               <td class="line-number" value="119"></td>
               <td class="line-content">        let bullets = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="120"></td>
               <td class="line-content">        let invaders = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="121"></td>
               <td class="line-content">        let invaderBullets = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="122"></td>
               <td class="line-content">        let barriers = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="123"></td>
               <td class="line-content">        let ufo = null;</td>
            </tr>
            <tr>
               <td class="line-number" value="124"></td>
               <td class="line-content">        let ufoBombs = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="125"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="126"></td>
               <td class="line-content">        // Bullet class</td>
            </tr>
            <tr>
               <td class="line-number" value="127"></td>
               <td class="line-content">        class Bullet {</td>
            </tr>
            <tr>
               <td class="line-number" value="128"></td>
               <td class="line-content">            constructor(x, y, speed, color = '#ffff00') {</td>
            </tr>
            <tr>
               <td class="line-number" value="129"></td>
               <td class="line-content">                this.x = x;</td>
            </tr>
            <tr>
               <td class="line-number" value="130"></td>
               <td class="line-content">                this.y = y;</td>
            </tr>
            <tr>
               <td class="line-number" value="131"></td>
               <td class="line-content">                this.width = 4;</td>
            </tr>
            <tr>
               <td class="line-number" value="132"></td>
               <td class="line-content">                this.height = 10;</td>
            </tr>
            <tr>
               <td class="line-number" value="133"></td>
               <td class="line-content">                this.speed = speed;</td>
            </tr>
            <tr>
               <td class="line-number" value="134"></td>
               <td class="line-content">                this.color = color;</td>
            </tr>
            <tr>
               <td class="line-number" value="135"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="136"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="137"></td>
               <td class="line-content">            update() {</td>
            </tr>
            <tr>
               <td class="line-number" value="138"></td>
               <td class="line-content">                this.y += this.speed;</td>
            </tr>
            <tr>
               <td class="line-number" value="139"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="140"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="141"></td>
               <td class="line-content">            draw() {</td>
            </tr>
            <tr>
               <td class="line-number" value="142"></td>
               <td class="line-content">                ctx.fillStyle = this.color;</td>
            </tr>
            <tr>
               <td class="line-number" value="143"></td>
               <td class="line-content">                ctx.fillRect(this.x, this.y, this.width, this.height);</td>
            </tr>
            <tr>
               <td class="line-number" value="144"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="145"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="146"></td>
               <td class="line-content">            isOffScreen() {</td>
            </tr>
            <tr>
               <td class="line-number" value="147"></td>
               <td class="line-content">                return this.y &lt; 0 || this.y &gt; canvas.height;</td>
            </tr>
            <tr>
               <td class="line-number" value="148"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="149"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="150"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="151"></td>
               <td class="line-content">        // Invader class</td>
            </tr>
            <tr>
               <td class="line-number" value="152"></td>
               <td class="line-content">        class Invader {</td>
            </tr>
            <tr>
               <td class="line-number" value="153"></td>
               <td class="line-content">            constructor(x, y, stage = 1) {</td>
            </tr>
            <tr>
               <td class="line-number" value="154"></td>
               <td class="line-content">                this.x = x;</td>
            </tr>
            <tr>
               <td class="line-number" value="155"></td>
               <td class="line-content">                this.y = y;</td>
            </tr>
            <tr>
               <td class="line-number" value="156"></td>
               <td class="line-content">                this.stage = stage;</td>
            </tr>
            <tr>
               <td class="line-number" value="157"></td>
               <td class="line-content">                this.direction = 1;</td>
            </tr>
            <tr>
               <td class="line-number" value="158"></td>
               <td class="line-content">                this.shootTimer = Math.random() * 200 + 100;</td>
            </tr>
            <tr>
               <td class="line-number" value="159"></td>
               <td class="line-content">                this.animationFrame = 0; // For leg animation</td>
            </tr>
            <tr>
               <td class="line-number" value="160"></td>
               <td class="line-content">                this.animationTimer = 0;</td>
            </tr>
            <tr>
               <td class="line-number" value="161"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="162"></td>
               <td class="line-content">                // Stage-specific properties</td>
            </tr>
            <tr>
               <td class="line-number" value="163"></td>
               <td class="line-content">                switch(stage) {</td>
            </tr>
            <tr>
               <td class="line-number" value="164"></td>
               <td class="line-content">                    case 1:</td>
            </tr>
            <tr>
               <td class="line-number" value="165"></td>
               <td class="line-content">                        this.width = 40;</td>
            </tr>
            <tr>
               <td class="line-number" value="166"></td>
               <td class="line-content">                        this.height = 30;</td>
            </tr>
            <tr>
               <td class="line-number" value="167"></td>
               <td class="line-content">                        this.speed = 1;</td>
            </tr>
            <tr>
               <td class="line-number" value="168"></td>
               <td class="line-content">                        this.color = '#ff0000';</td>
            </tr>
            <tr>
               <td class="line-number" value="169"></td>
               <td class="line-content">                        this.health = 1;</td>
            </tr>
            <tr>
               <td class="line-number" value="170"></td>
               <td class="line-content">                        this.shootRate = 0.001;</td>
            </tr>
            <tr>
               <td class="line-number" value="171"></td>
               <td class="line-content">                        this.legCount = 2;</td>
            </tr>
            <tr>
               <td class="line-number" value="172"></td>
               <td class="line-content">                        break;</td>
            </tr>
            <tr>
               <td class="line-number" value="173"></td>
               <td class="line-content">                    case 2:</td>
            </tr>
            <tr>
               <td class="line-number" value="174"></td>
               <td class="line-content">                        this.width = 50;</td>
            </tr>
            <tr>
               <td class="line-number" value="175"></td>
               <td class="line-content">                        this.height = 40;</td>
            </tr>
            <tr>
               <td class="line-number" value="176"></td>
               <td class="line-content">                        this.speed = 1.5;</td>
            </tr>
            <tr>
               <td class="line-number" value="177"></td>
               <td class="line-content">                        this.color = '#ff8800';</td>
            </tr>
            <tr>
               <td class="line-number" value="178"></td>
               <td class="line-content">                        this.health = 2;</td>
            </tr>
            <tr>
               <td class="line-number" value="179"></td>
               <td class="line-content">                        this.shootRate = 0.002;</td>
            </tr>
            <tr>
               <td class="line-number" value="180"></td>
               <td class="line-content">                        this.legCount = 3;</td>
            </tr>
            <tr>
               <td class="line-number" value="181"></td>
               <td class="line-content">                        break;</td>
            </tr>
            <tr>
               <td class="line-number" value="182"></td>
               <td class="line-content">                    case 3:</td>
            </tr>
            <tr>
               <td class="line-number" value="183"></td>
               <td class="line-content">                        this.width = 80;</td>
            </tr>
            <tr>
               <td class="line-number" value="184"></td>
               <td class="line-content">                        this.height = 60;</td>
            </tr>
            <tr>
               <td class="line-number" value="185"></td>
               <td class="line-content">                        this.speed = 0.8;</td>
            </tr>
            <tr>
               <td class="line-number" value="186"></td>
               <td class="line-content">                        this.color = '#8800ff';</td>
            </tr>
            <tr>
               <td class="line-number" value="187"></td>
               <td class="line-content">                        this.health = 5;</td>
            </tr>
            <tr>
               <td class="line-number" value="188"></td>
               <td class="line-content">                        this.shootRate = 0.005;</td>
            </tr>
            <tr>
               <td class="line-number" value="189"></td>
               <td class="line-content">                        this.legCount = 4;</td>
            </tr>
            <tr>
               <td class="line-number" value="190"></td>
               <td class="line-content">                        break;</td>
            </tr>
            <tr>
               <td class="line-number" value="191"></td>
               <td class="line-content">                    case 4:</td>
            </tr>
            <tr>
               <td class="line-number" value="192"></td>
               <td class="line-content">                        this.width = 120;</td>
            </tr>
            <tr>
               <td class="line-number" value="193"></td>
               <td class="line-content">                        this.height = 100;</td>
            </tr>
            <tr>
               <td class="line-number" value="194"></td>
               <td class="line-content">                        this.speed = 0.5;</td>
            </tr>
            <tr>
               <td class="line-number" value="195"></td>
               <td class="line-content">                        this.color = '#ff0088';</td>
            </tr>
            <tr>
               <td class="line-number" value="196"></td>
               <td class="line-content">                        this.health = 10;</td>
            </tr>
            <tr>
               <td class="line-number" value="197"></td>
               <td class="line-content">                        this.shootRate = 0.008;</td>
            </tr>
            <tr>
               <td class="line-number" value="198"></td>
               <td class="line-content">                        this.legCount = 4;</td>
            </tr>
            <tr>
               <td class="line-number" value="199"></td>
               <td class="line-content">                        break;</td>
            </tr>
            <tr>
               <td class="line-number" value="200"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="201"></td>
               <td class="line-content">                this.maxHealth = this.health;</td>
            </tr>
            <tr>
               <td class="line-number" value="202"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="203"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="204"></td>
               <td class="line-content">            update() {</td>
            </tr>
            <tr>
               <td class="line-number" value="205"></td>
               <td class="line-content">                this.x += this.speed * this.direction;</td>
            </tr>
            <tr>
               <td class="line-number" value="206"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="207"></td>
               <td class="line-content">                // Update leg animation</td>
            </tr>
            <tr>
               <td class="line-number" value="208"></td>
               <td class="line-content">                this.animationTimer++;</td>
            </tr>
            <tr>
               <td class="line-number" value="209"></td>
               <td class="line-content">                if (this.animationTimer &gt;= 15) { // Change animation every 15 frames</td>
            </tr>
            <tr>
               <td class="line-number" value="210"></td>
               <td class="line-content">                    this.animationFrame = (this.animationFrame + 1) % 2;</td>
            </tr>
            <tr>
               <td class="line-number" value="211"></td>
               <td class="line-content">                    this.animationTimer = 0;</td>
            </tr>
            <tr>
               <td class="line-number" value="212"></td>
               <td class="line-content">                    </td>
            </tr>
            <tr>
               <td class="line-number" value="213"></td>
               <td class="line-content">                    // Play move sound occasionally</td>
            </tr>
            <tr>
               <td class="line-number" value="214"></td>
               <td class="line-content">                    if (Math.random() &lt; 0.1) {</td>
            </tr>
            <tr>
               <td class="line-number" value="215"></td>
               <td class="line-content">                        playInvaderMoveSound(this.stage);</td>
            </tr>
            <tr>
               <td class="line-number" value="216"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="217"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="218"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="219"></td>
               <td class="line-content">                // Shooting logic - more frequent for higher stages</td>
            </tr>
            <tr>
               <td class="line-number" value="220"></td>
               <td class="line-content">                this.shootTimer--;</td>
            </tr>
            <tr>
               <td class="line-number" value="221"></td>
               <td class="line-content">                if (this.shootTimer &lt;= 0 &amp;&amp; Math.random() &lt; this.shootRate) {</td>
            </tr>
            <tr>
               <td class="line-number" value="222"></td>
               <td class="line-content">                    // Stage 3 and 4 shoot multiple bullets</td>
            </tr>
            <tr>
               <td class="line-number" value="223"></td>
               <td class="line-content">                    if (this.stage &gt;= 3) {</td>
            </tr>
            <tr>
               <td class="line-number" value="224"></td>
               <td class="line-content">                        for (let i = 0; i &lt; 3; i++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="225"></td>
               <td class="line-content">                            invaderBullets.push(new Bullet(</td>
            </tr>
            <tr>
               <td class="line-number" value="226"></td>
               <td class="line-content">                                this.x + this.width/2 + (i-1) * 20, </td>
            </tr>
            <tr>
               <td class="line-number" value="227"></td>
               <td class="line-content">                                this.y + this.height, </td>
            </tr>
            <tr>
               <td class="line-number" value="228"></td>
               <td class="line-content">                                3, </td>
            </tr>
            <tr>
               <td class="line-number" value="229"></td>
               <td class="line-content">                                '#ff0000'</td>
            </tr>
            <tr>
               <td class="line-number" value="230"></td>
               <td class="line-content">                            ));</td>
            </tr>
            <tr>
               <td class="line-number" value="231"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="232"></td>
               <td class="line-content">                    } else {</td>
            </tr>
            <tr>
               <td class="line-number" value="233"></td>
               <td class="line-content">                        invaderBullets.push(new Bullet(this.x + this.width/2, this.y + this.height, 3, '#ff0000'));</td>
            </tr>
            <tr>
               <td class="line-number" value="234"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="235"></td>
               <td class="line-content">                    this.shootTimer = Math.random() * 300 + 200;</td>
            </tr>
            <tr>
               <td class="line-number" value="236"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="237"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="238"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="239"></td>
               <td class="line-content">            draw() {</td>
            </tr>
            <tr>
               <td class="line-number" value="240"></td>
               <td class="line-content">                // Health-based color intensity</td>
            </tr>
            <tr>
               <td class="line-number" value="241"></td>
               <td class="line-content">                const healthRatio = this.health / this.maxHealth;</td>
            </tr>
            <tr>
               <td class="line-number" value="242"></td>
               <td class="line-content">                let drawColor = this.color;</td>
            </tr>
            <tr>
               <td class="line-number" value="243"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="244"></td>
               <td class="line-content">                if (healthRatio &lt; 1) {</td>
            </tr>
            <tr>
               <td class="line-number" value="245"></td>
               <td class="line-content">                    // Darken color as health decreases</td>
            </tr>
            <tr>
               <td class="line-number" value="246"></td>
               <td class="line-content">                    const r = parseInt(this.color.substr(1, 2), 16);</td>
            </tr>
            <tr>
               <td class="line-number" value="247"></td>
               <td class="line-content">                    const g = parseInt(this.color.substr(3, 2), 16);</td>
            </tr>
            <tr>
               <td class="line-number" value="248"></td>
               <td class="line-content">                    const b = parseInt(this.color.substr(5, 2), 16);</td>
            </tr>
            <tr>
               <td class="line-number" value="249"></td>
               <td class="line-content">                    drawColor = `rgb(${Math.floor(r * healthRatio)}, ${Math.floor(g * healthRatio)}, ${Math.floor(b * healthRatio)})`;</td>
            </tr>
            <tr>
               <td class="line-number" value="250"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="251"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="252"></td>
               <td class="line-content">                // Draw main body</td>
            </tr>
            <tr>
               <td class="line-number" value="253"></td>
               <td class="line-content">                ctx.fillStyle = drawColor;</td>
            </tr>
            <tr>
               <td class="line-number" value="254"></td>
               <td class="line-content">                ctx.fillRect(this.x, this.y, this.width, this.height);</td>
            </tr>
            <tr>
               <td class="line-number" value="255"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="256"></td>
               <td class="line-content">                // Stage-specific appearance</td>
            </tr>
            <tr>
               <td class="line-number" value="257"></td>
               <td class="line-content">                switch(this.stage) {</td>
            </tr>
            <tr>
               <td class="line-number" value="258"></td>
               <td class="line-content">                    case 1:</td>
            </tr>
            <tr>
               <td class="line-number" value="259"></td>
               <td class="line-content">                        // Simple invader</td>
            </tr>
            <tr>
               <td class="line-number" value="260"></td>
               <td class="line-content">                        ctx.fillStyle = '#000';</td>
            </tr>
            <tr>
               <td class="line-number" value="261"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 5, this.y + 5, 8, 8);</td>
            </tr>
            <tr>
               <td class="line-number" value="262"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 27, this.y + 5, 8, 8);</td>
            </tr>
            <tr>
               <td class="line-number" value="263"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 15, this.y + 15, 10, 5);</td>
            </tr>
            <tr>
               <td class="line-number" value="264"></td>
               <td class="line-content">                        break;</td>
            </tr>
            <tr>
               <td class="line-number" value="265"></td>
               <td class="line-content">                    case 2:</td>
            </tr>
            <tr>
               <td class="line-number" value="266"></td>
               <td class="line-content">                        // Medium invader with more details</td>
            </tr>
            <tr>
               <td class="line-number" value="267"></td>
               <td class="line-content">                        ctx.fillStyle = '#000';</td>
            </tr>
            <tr>
               <td class="line-number" value="268"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 8, this.y + 8, 10, 10);</td>
            </tr>
            <tr>
               <td class="line-number" value="269"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 32, this.y + 8, 10, 10);</td>
            </tr>
            <tr>
               <td class="line-number" value="270"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 18, this.y + 20, 14, 8);</td>
            </tr>
            <tr>
               <td class="line-number" value="271"></td>
               <td class="line-content">                        ctx.fillStyle = '#ffff00';</td>
            </tr>
            <tr>
               <td class="line-number" value="272"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 20, this.y + 25, 10, 5);</td>
            </tr>
            <tr>
               <td class="line-number" value="273"></td>
               <td class="line-content">                        break;</td>
            </tr>
            <tr>
               <td class="line-number" value="274"></td>
               <td class="line-content">                    case 3:</td>
            </tr>
            <tr>
               <td class="line-number" value="275"></td>
               <td class="line-content">                        // Large invader</td>
            </tr>
            <tr>
               <td class="line-number" value="276"></td>
               <td class="line-content">                        ctx.fillStyle = '#000';</td>
            </tr>
            <tr>
               <td class="line-number" value="277"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 15, this.y + 15, 15, 15);</td>
            </tr>
            <tr>
               <td class="line-number" value="278"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 50, this.y + 15, 15, 15);</td>
            </tr>
            <tr>
               <td class="line-number" value="279"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 30, this.y + 35, 20, 10);</td>
            </tr>
            <tr>
               <td class="line-number" value="280"></td>
               <td class="line-content">                        ctx.fillStyle = '#ffff00';</td>
            </tr>
            <tr>
               <td class="line-number" value="281"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 10, this.y + 10, 8, 8);</td>
            </tr>
            <tr>
               <td class="line-number" value="282"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 62, this.y + 10, 8, 8);</td>
            </tr>
            <tr>
               <td class="line-number" value="283"></td>
               <td class="line-content">                        break;</td>
            </tr>
            <tr>
               <td class="line-number" value="284"></td>
               <td class="line-content">                    case 4:</td>
            </tr>
            <tr>
               <td class="line-number" value="285"></td>
               <td class="line-content">                        // Boss monster</td>
            </tr>
            <tr>
               <td class="line-number" value="286"></td>
               <td class="line-content">                        ctx.fillStyle = '#000';</td>
            </tr>
            <tr>
               <td class="line-number" value="287"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 20, this.y + 20, 20, 20);</td>
            </tr>
            <tr>
               <td class="line-number" value="288"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 80, this.y + 20, 20, 20);</td>
            </tr>
            <tr>
               <td class="line-number" value="289"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 45, this.y + 50, 30, 15);</td>
            </tr>
            <tr>
               <td class="line-number" value="290"></td>
               <td class="line-content">                        ctx.fillStyle = '#ffff00';</td>
            </tr>
            <tr>
               <td class="line-number" value="291"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 15, this.y + 15, 12, 12);</td>
            </tr>
            <tr>
               <td class="line-number" value="292"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 93, this.y + 15, 12, 12);</td>
            </tr>
            <tr>
               <td class="line-number" value="293"></td>
               <td class="line-content">                        ctx.fillStyle = '#ff0000';</td>
            </tr>
            <tr>
               <td class="line-number" value="294"></td>
               <td class="line-content">                        ctx.fillRect(this.x + 50, this.y + 70, 20, 10);</td>
            </tr>
            <tr>
               <td class="line-number" value="295"></td>
               <td class="line-content">                        break;</td>
            </tr>
            <tr>
               <td class="line-number" value="296"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="297"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="298"></td>
               <td class="line-content">                // Draw animated legs</td>
            </tr>
            <tr>
               <td class="line-number" value="299"></td>
               <td class="line-content">                this.drawLegs();</td>
            </tr>
            <tr>
               <td class="line-number" value="300"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="301"></td>
               <td class="line-content">                // Health bar for stages 3 and 4</td>
            </tr>
            <tr>
               <td class="line-number" value="302"></td>
               <td class="line-content">                if (this.stage &gt;= 3) {</td>
            </tr>
            <tr>
               <td class="line-number" value="303"></td>
               <td class="line-content">                    const barWidth = this.width;</td>
            </tr>
            <tr>
               <td class="line-number" value="304"></td>
               <td class="line-content">                    const barHeight = 4;</td>
            </tr>
            <tr>
               <td class="line-number" value="305"></td>
               <td class="line-content">                    const barY = this.y - 8;</td>
            </tr>
            <tr>
               <td class="line-number" value="306"></td>
               <td class="line-content">                    </td>
            </tr>
            <tr>
               <td class="line-number" value="307"></td>
               <td class="line-content">                    // Background</td>
            </tr>
            <tr>
               <td class="line-number" value="308"></td>
               <td class="line-content">                    ctx.fillStyle = '#333';</td>
            </tr>
            <tr>
               <td class="line-number" value="309"></td>
               <td class="line-content">                    ctx.fillRect(this.x, barY, barWidth, barHeight);</td>
            </tr>
            <tr>
               <td class="line-number" value="310"></td>
               <td class="line-content">                    </td>
            </tr>
            <tr>
               <td class="line-number" value="311"></td>
               <td class="line-content">                    // Health</td>
            </tr>
            <tr>
               <td class="line-number" value="312"></td>
               <td class="line-content">                    ctx.fillStyle = healthRatio &gt; 0.5 ? '#00ff00' : healthRatio &gt; 0.25 ? '#ffff00' : '#ff0000';</td>
            </tr>
            <tr>
               <td class="line-number" value="313"></td>
               <td class="line-content">                    ctx.fillRect(this.x, barY, barWidth * healthRatio, barHeight);</td>
            </tr>
            <tr>
               <td class="line-number" value="314"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="315"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="316"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="317"></td>
               <td class="line-content">            drawLegs() {</td>
            </tr>
            <tr>
               <td class="line-number" value="318"></td>
               <td class="line-content">                ctx.fillStyle = this.color;</td>
            </tr>
            <tr>
               <td class="line-number" value="319"></td>
               <td class="line-content">                const legWidth = Math.max(3, Math.floor(this.width / 15));</td>
            </tr>
            <tr>
               <td class="line-number" value="320"></td>
               <td class="line-content">                const legHeight = Math.max(8, Math.floor(this.height / 4));</td>
            </tr>
            <tr>
               <td class="line-number" value="321"></td>
               <td class="line-content">                const legSpacing = this.width / (this.legCount + 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="322"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="323"></td>
               <td class="line-content">                for (let i = 0; i &lt; this.legCount; i++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="324"></td>
               <td class="line-content">                    const legX = this.x + legSpacing * (i + 1) - legWidth / 2;</td>
            </tr>
            <tr>
               <td class="line-number" value="325"></td>
               <td class="line-content">                    let legY = this.y + this.height;</td>
            </tr>
            <tr>
               <td class="line-number" value="326"></td>
               <td class="line-content">                    </td>
            </tr>
            <tr>
               <td class="line-number" value="327"></td>
               <td class="line-content">                    // Animate legs - alternate between two positions</td>
            </tr>
            <tr>
               <td class="line-number" value="328"></td>
               <td class="line-content">                    if (this.animationFrame === 0) {</td>
            </tr>
            <tr>
               <td class="line-number" value="329"></td>
               <td class="line-content">                        // Normal position</td>
            </tr>
            <tr>
               <td class="line-number" value="330"></td>
               <td class="line-content">                        ctx.fillRect(legX, legY, legWidth, legHeight);</td>
            </tr>
            <tr>
               <td class="line-number" value="331"></td>
               <td class="line-content">                        // Add foot</td>
            </tr>
            <tr>
               <td class="line-number" value="332"></td>
               <td class="line-content">                        ctx.fillRect(legX - 2, legY + legHeight, legWidth + 4, 3);</td>
            </tr>
            <tr>
               <td class="line-number" value="333"></td>
               <td class="line-content">                    } else {</td>
            </tr>
            <tr>
               <td class="line-number" value="334"></td>
               <td class="line-content">                        // Slightly moved position for walking animation</td>
            </tr>
            <tr>
               <td class="line-number" value="335"></td>
               <td class="line-content">                        const offset = (i % 2 === 0) ? 2 : -2;</td>
            </tr>
            <tr>
               <td class="line-number" value="336"></td>
               <td class="line-content">                        ctx.fillRect(legX + offset, legY, legWidth, legHeight);</td>
            </tr>
            <tr>
               <td class="line-number" value="337"></td>
               <td class="line-content">                        // Add foot</td>
            </tr>
            <tr>
               <td class="line-number" value="338"></td>
               <td class="line-content">                        ctx.fillRect(legX + offset - 2, legY + legHeight, legWidth + 4, 3);</td>
            </tr>
            <tr>
               <td class="line-number" value="339"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="340"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="341"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="342"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="343"></td>
               <td class="line-content">            takeDamage() {</td>
            </tr>
            <tr>
               <td class="line-number" value="344"></td>
               <td class="line-content">                this.health--;</td>
            </tr>
            <tr>
               <td class="line-number" value="345"></td>
               <td class="line-content">                return this.health &lt;= 0;</td>
            </tr>
            <tr>
               <td class="line-number" value="346"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="347"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="348"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="349"></td>
               <td class="line-content">        // Barrier class</td>
            </tr>
            <tr>
               <td class="line-number" value="350"></td>
               <td class="line-content">        class Barrier {</td>
            </tr>
            <tr>
               <td class="line-number" value="351"></td>
               <td class="line-content">            constructor(x, y) {</td>
            </tr>
            <tr>
               <td class="line-number" value="352"></td>
               <td class="line-content">                this.x = x;</td>
            </tr>
            <tr>
               <td class="line-number" value="353"></td>
               <td class="line-content">                this.y = y;</td>
            </tr>
            <tr>
               <td class="line-number" value="354"></td>
               <td class="line-content">                this.width = 80;</td>
            </tr>
            <tr>
               <td class="line-number" value="355"></td>
               <td class="line-content">                this.height = 60;</td>
            </tr>
            <tr>
               <td class="line-number" value="356"></td>
               <td class="line-content">                this.blockSize = 4;</td>
            </tr>
            <tr>
               <td class="line-number" value="357"></td>
               <td class="line-content">                this.color = '#00ff00';</td>
            </tr>
            <tr>
               <td class="line-number" value="358"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="359"></td>
               <td class="line-content">                // Create barrier structure as a 2D array (20x15 blocks)</td>
            </tr>
            <tr>
               <td class="line-number" value="360"></td>
               <td class="line-content">                this.blocks = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="361"></td>
               <td class="line-content">                this.initializeBlocks();</td>
            </tr>
            <tr>
               <td class="line-number" value="362"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="363"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="364"></td>
               <td class="line-content">            initializeBlocks() {</td>
            </tr>
            <tr>
               <td class="line-number" value="365"></td>
               <td class="line-content">                const rows = this.height / this.blockSize;</td>
            </tr>
            <tr>
               <td class="line-number" value="366"></td>
               <td class="line-content">                const cols = this.width / this.blockSize;</td>
            </tr>
            <tr>
               <td class="line-number" value="367"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="368"></td>
               <td class="line-content">                // Create barrier shape pattern</td>
            </tr>
            <tr>
               <td class="line-number" value="369"></td>
               <td class="line-content">                const pattern = [</td>
            </tr>
            <tr>
               <td class="line-number" value="370"></td>
               <td class="line-content">                    "11111111111111111111",</td>
            </tr>
            <tr>
               <td class="line-number" value="371"></td>
               <td class="line-content">                    "11111111111111111111",</td>
            </tr>
            <tr>
               <td class="line-number" value="372"></td>
               <td class="line-content">                    "11111111111111111111",</td>
            </tr>
            <tr>
               <td class="line-number" value="373"></td>
               <td class="line-content">                    "11111111111111111111",</td>
            </tr>
            <tr>
               <td class="line-number" value="374"></td>
               <td class="line-content">                    "11111111111111111111",</td>
            </tr>
            <tr>
               <td class="line-number" value="375"></td>
               <td class="line-content">                    "11111111111111111111",</td>
            </tr>
            <tr>
               <td class="line-number" value="376"></td>
               <td class="line-content">                    "11111111111111111111",</td>
            </tr>
            <tr>
               <td class="line-number" value="377"></td>
               <td class="line-content">                    "11111111111111111111",</td>
            </tr>
            <tr>
               <td class="line-number" value="378"></td>
               <td class="line-content">                    "11111111111111111111",</td>
            </tr>
            <tr>
               <td class="line-number" value="379"></td>
               <td class="line-content">                    "11111000000000001111",</td>
            </tr>
            <tr>
               <td class="line-number" value="380"></td>
               <td class="line-content">                    "11110000000000011111",</td>
            </tr>
            <tr>
               <td class="line-number" value="381"></td>
               <td class="line-content">                    "11100000000000111111",</td>
            </tr>
            <tr>
               <td class="line-number" value="382"></td>
               <td class="line-content">                    "11000000000001111111",</td>
            </tr>
            <tr>
               <td class="line-number" value="383"></td>
               <td class="line-content">                    "10000000000011111111",</td>
            </tr>
            <tr>
               <td class="line-number" value="384"></td>
               <td class="line-content">                    "00000000000111111111"</td>
            </tr>
            <tr>
               <td class="line-number" value="385"></td>
               <td class="line-content">                ];</td>
            </tr>
            <tr>
               <td class="line-number" value="386"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="387"></td>
               <td class="line-content">                for (let row = 0; row &lt; rows; row++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="388"></td>
               <td class="line-content">                    this.blocks[row] = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="389"></td>
               <td class="line-content">                    for (let col = 0; col &lt; cols; col++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="390"></td>
               <td class="line-content">                        if (row &lt; pattern.length &amp;&amp; col &lt; pattern[row].length) {</td>
            </tr>
            <tr>
               <td class="line-number" value="391"></td>
               <td class="line-content">                            this.blocks[row][col] = pattern[row][col] === '1';</td>
            </tr>
            <tr>
               <td class="line-number" value="392"></td>
               <td class="line-content">                        } else {</td>
            </tr>
            <tr>
               <td class="line-number" value="393"></td>
               <td class="line-content">                            this.blocks[row][col] = false;</td>
            </tr>
            <tr>
               <td class="line-number" value="394"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="395"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="396"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="397"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="398"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="399"></td>
               <td class="line-content">            draw() {</td>
            </tr>
            <tr>
               <td class="line-number" value="400"></td>
               <td class="line-content">                ctx.fillStyle = this.color;</td>
            </tr>
            <tr>
               <td class="line-number" value="401"></td>
               <td class="line-content">                for (let row = 0; row &lt; this.blocks.length; row++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="402"></td>
               <td class="line-content">                    for (let col = 0; col &lt; this.blocks[row].length; col++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="403"></td>
               <td class="line-content">                        if (this.blocks[row][col]) {</td>
            </tr>
            <tr>
               <td class="line-number" value="404"></td>
               <td class="line-content">                            ctx.fillRect(</td>
            </tr>
            <tr>
               <td class="line-number" value="405"></td>
               <td class="line-content">                                this.x + col * this.blockSize,</td>
            </tr>
            <tr>
               <td class="line-number" value="406"></td>
               <td class="line-content">                                this.y + row * this.blockSize,</td>
            </tr>
            <tr>
               <td class="line-number" value="407"></td>
               <td class="line-content">                                this.blockSize,</td>
            </tr>
            <tr>
               <td class="line-number" value="408"></td>
               <td class="line-content">                                this.blockSize</td>
            </tr>
            <tr>
               <td class="line-number" value="409"></td>
               <td class="line-content">                            );</td>
            </tr>
            <tr>
               <td class="line-number" value="410"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="411"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="412"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="413"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="414"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="415"></td>
               <td class="line-content">            checkCollision(bulletX, bulletY, bulletWidth, bulletHeight) {</td>
            </tr>
            <tr>
               <td class="line-number" value="416"></td>
               <td class="line-content">                // Check if bullet overlaps with barrier bounds</td>
            </tr>
            <tr>
               <td class="line-number" value="417"></td>
               <td class="line-content">                if (bulletX + bulletWidth &lt; this.x || bulletX &gt; this.x + this.width ||</td>
            </tr>
            <tr>
               <td class="line-number" value="418"></td>
               <td class="line-content">                    bulletY + bulletHeight &lt; this.y || bulletY &gt; this.y + this.height) {</td>
            </tr>
            <tr>
               <td class="line-number" value="419"></td>
               <td class="line-content">                    return false;</td>
            </tr>
            <tr>
               <td class="line-number" value="420"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="421"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="422"></td>
               <td class="line-content">                // Check collision with individual blocks</td>
            </tr>
            <tr>
               <td class="line-number" value="423"></td>
               <td class="line-content">                const startCol = Math.max(0, Math.floor((bulletX - this.x) / this.blockSize));</td>
            </tr>
            <tr>
               <td class="line-number" value="424"></td>
               <td class="line-content">                const endCol = Math.min(this.blocks[0].length - 1, Math.floor((bulletX + bulletWidth - this.x) / this.blockSize));</td>
            </tr>
            <tr>
               <td class="line-number" value="425"></td>
               <td class="line-content">                const startRow = Math.max(0, Math.floor((bulletY - this.y) / this.blockSize));</td>
            </tr>
            <tr>
               <td class="line-number" value="426"></td>
               <td class="line-content">                const endRow = Math.min(this.blocks.length - 1, Math.floor((bulletY + bulletHeight - this.y) / this.blockSize));</td>
            </tr>
            <tr>
               <td class="line-number" value="427"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="428"></td>
               <td class="line-content">                for (let row = startRow; row &lt;= endRow; row++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="429"></td>
               <td class="line-content">                    for (let col = startCol; col &lt;= endCol; col++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="430"></td>
               <td class="line-content">                        if (this.blocks[row][col]) {</td>
            </tr>
            <tr>
               <td class="line-number" value="431"></td>
               <td class="line-content">                            // Destroy blocks in a small area around the hit</td>
            </tr>
            <tr>
               <td class="line-number" value="432"></td>
               <td class="line-content">                            this.destroyBlocks(col, row, 2);</td>
            </tr>
            <tr>
               <td class="line-number" value="433"></td>
               <td class="line-content">                            return true;</td>
            </tr>
            <tr>
               <td class="line-number" value="434"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="435"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="436"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="437"></td>
               <td class="line-content">                return false;</td>
            </tr>
            <tr>
               <td class="line-number" value="438"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="439"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="440"></td>
               <td class="line-content">            destroyBlocks(centerCol, centerRow, radius) {</td>
            </tr>
            <tr>
               <td class="line-number" value="441"></td>
               <td class="line-content">                for (let row = Math.max(0, centerRow - radius); </td>
            </tr>
            <tr>
               <td class="line-number" value="442"></td>
               <td class="line-content">                     row &lt;= Math.min(this.blocks.length - 1, centerRow + radius); row++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="443"></td>
               <td class="line-content">                    for (let col = Math.max(0, centerCol - radius); </td>
            </tr>
            <tr>
               <td class="line-number" value="444"></td>
               <td class="line-content">                         col &lt;= Math.min(this.blocks[0].length - 1, centerCol + radius); col++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="445"></td>
               <td class="line-content">                        // Create circular destruction pattern</td>
            </tr>
            <tr>
               <td class="line-number" value="446"></td>
               <td class="line-content">                        const distance = Math.sqrt((col - centerCol) ** 2 + (row - centerRow) ** 2);</td>
            </tr>
            <tr>
               <td class="line-number" value="447"></td>
               <td class="line-content">                        if (distance &lt;= radius) {</td>
            </tr>
            <tr>
               <td class="line-number" value="448"></td>
               <td class="line-content">                            this.blocks[row][col] = false;</td>
            </tr>
            <tr>
               <td class="line-number" value="449"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="450"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="451"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="452"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="453"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="454"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="455"></td>
               <td class="line-content">        // UFO Bomb class</td>
            </tr>
            <tr>
               <td class="line-number" value="456"></td>
               <td class="line-content">        class UFOBomb {</td>
            </tr>
            <tr>
               <td class="line-number" value="457"></td>
               <td class="line-content">            constructor(x, y) {</td>
            </tr>
            <tr>
               <td class="line-number" value="458"></td>
               <td class="line-content">                this.x = x;</td>
            </tr>
            <tr>
               <td class="line-number" value="459"></td>
               <td class="line-content">                this.y = y;</td>
            </tr>
            <tr>
               <td class="line-number" value="460"></td>
               <td class="line-content">                this.width = 12;</td>
            </tr>
            <tr>
               <td class="line-number" value="461"></td>
               <td class="line-content">                this.height = 20;</td>
            </tr>
            <tr>
               <td class="line-number" value="462"></td>
               <td class="line-content">                this.speed = 2;</td>
            </tr>
            <tr>
               <td class="line-number" value="463"></td>
               <td class="line-content">                this.color = '#ff8800';</td>
            </tr>
            <tr>
               <td class="line-number" value="464"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="465"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="466"></td>
               <td class="line-content">            update() {</td>
            </tr>
            <tr>
               <td class="line-number" value="467"></td>
               <td class="line-content">                this.y += this.speed;</td>
            </tr>
            <tr>
               <td class="line-number" value="468"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="469"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="470"></td>
               <td class="line-content">            draw() {</td>
            </tr>
            <tr>
               <td class="line-number" value="471"></td>
               <td class="line-content">                // Draw large bomb</td>
            </tr>
            <tr>
               <td class="line-number" value="472"></td>
               <td class="line-content">                ctx.fillStyle = this.color;</td>
            </tr>
            <tr>
               <td class="line-number" value="473"></td>
               <td class="line-content">                ctx.fillRect(this.x, this.y, this.width, this.height);</td>
            </tr>
            <tr>
               <td class="line-number" value="474"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="475"></td>
               <td class="line-content">                // Add some detail to make it look like a bomb</td>
            </tr>
            <tr>
               <td class="line-number" value="476"></td>
               <td class="line-content">                ctx.fillStyle = '#ffaa00';</td>
            </tr>
            <tr>
               <td class="line-number" value="477"></td>
               <td class="line-content">                ctx.fillRect(this.x + 2, this.y + 2, this.width - 4, this.height - 4);</td>
            </tr>
            <tr>
               <td class="line-number" value="478"></td>
               <td class="line-content">                ctx.fillStyle = '#ff6600';</td>
            </tr>
            <tr>
               <td class="line-number" value="479"></td>
               <td class="line-content">                ctx.fillRect(this.x + 4, this.y + 4, this.width - 8, this.height - 8);</td>
            </tr>
            <tr>
               <td class="line-number" value="480"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="481"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="482"></td>
               <td class="line-content">            isOffScreen() {</td>
            </tr>
            <tr>
               <td class="line-number" value="483"></td>
               <td class="line-content">                return this.y &gt; canvas.height;</td>
            </tr>
            <tr>
               <td class="line-number" value="484"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="485"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="486"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="487"></td>
               <td class="line-content">        // UFO class</td>
            </tr>
            <tr>
               <td class="line-number" value="488"></td>
               <td class="line-content">        class UFO {</td>
            </tr>
            <tr>
               <td class="line-number" value="489"></td>
               <td class="line-content">            constructor() {</td>
            </tr>
            <tr>
               <td class="line-number" value="490"></td>
               <td class="line-content">                this.width = 60;</td>
            </tr>
            <tr>
               <td class="line-number" value="491"></td>
               <td class="line-content">                this.height = 25;</td>
            </tr>
            <tr>
               <td class="line-number" value="492"></td>
               <td class="line-content">                this.speed = 2;</td>
            </tr>
            <tr>
               <td class="line-number" value="493"></td>
               <td class="line-content">                this.color = '#ff00ff';</td>
            </tr>
            <tr>
               <td class="line-number" value="494"></td>
               <td class="line-content">                this.bombTimer = Math.random() * 200 + 100;</td>
            </tr>
            <tr>
               <td class="line-number" value="495"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="496"></td>
               <td class="line-content">                // Randomly choose direction and starting position</td>
            </tr>
            <tr>
               <td class="line-number" value="497"></td>
               <td class="line-content">                if (Math.random() &lt; 0.5) {</td>
            </tr>
            <tr>
               <td class="line-number" value="498"></td>
               <td class="line-content">                    // Move left to right</td>
            </tr>
            <tr>
               <td class="line-number" value="499"></td>
               <td class="line-content">                    this.x = -this.width;</td>
            </tr>
            <tr>
               <td class="line-number" value="500"></td>
               <td class="line-content">                    this.direction = 1;</td>
            </tr>
            <tr>
               <td class="line-number" value="501"></td>
               <td class="line-content">                } else {</td>
            </tr>
            <tr>
               <td class="line-number" value="502"></td>
               <td class="line-content">                    // Move right to left</td>
            </tr>
            <tr>
               <td class="line-number" value="503"></td>
               <td class="line-content">                    this.x = canvas.width;</td>
            </tr>
            <tr>
               <td class="line-number" value="504"></td>
               <td class="line-content">                    this.direction = -1;</td>
            </tr>
            <tr>
               <td class="line-number" value="505"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="506"></td>
               <td class="line-content">                this.y = 30;</td>
            </tr>
            <tr>
               <td class="line-number" value="507"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="508"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="509"></td>
               <td class="line-content">            update() {</td>
            </tr>
            <tr>
               <td class="line-number" value="510"></td>
               <td class="line-content">                this.x += this.speed * this.direction;</td>
            </tr>
            <tr>
               <td class="line-number" value="511"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="512"></td>
               <td class="line-content">                // Drop bombs occasionally</td>
            </tr>
            <tr>
               <td class="line-number" value="513"></td>
               <td class="line-content">                this.bombTimer--;</td>
            </tr>
            <tr>
               <td class="line-number" value="514"></td>
               <td class="line-content">                if (this.bombTimer &lt;= 0 &amp;&amp; Math.random() &lt; 0.02) {</td>
            </tr>
            <tr>
               <td class="line-number" value="515"></td>
               <td class="line-content">                    ufoBombs.push(new UFOBomb(this.x + this.width/2 - 6, this.y + this.height));</td>
            </tr>
            <tr>
               <td class="line-number" value="516"></td>
               <td class="line-content">                    this.bombTimer = Math.random() * 150 + 100;</td>
            </tr>
            <tr>
               <td class="line-number" value="517"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="518"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="519"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="520"></td>
               <td class="line-content">            draw() {</td>
            </tr>
            <tr>
               <td class="line-number" value="521"></td>
               <td class="line-content">                // Draw UFO body</td>
            </tr>
            <tr>
               <td class="line-number" value="522"></td>
               <td class="line-content">                ctx.fillStyle = this.color;</td>
            </tr>
            <tr>
               <td class="line-number" value="523"></td>
               <td class="line-content">                ctx.fillRect(this.x + 10, this.y + 10, this.width - 20, this.height - 10);</td>
            </tr>
            <tr>
               <td class="line-number" value="524"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="525"></td>
               <td class="line-content">                // Draw UFO dome</td>
            </tr>
            <tr>
               <td class="line-number" value="526"></td>
               <td class="line-content">                ctx.fillStyle = '#ff66ff';</td>
            </tr>
            <tr>
               <td class="line-number" value="527"></td>
               <td class="line-content">                ctx.fillRect(this.x + 15, this.y, this.width - 30, 15);</td>
            </tr>
            <tr>
               <td class="line-number" value="528"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="529"></td>
               <td class="line-content">                // Draw UFO base/rim</td>
            </tr>
            <tr>
               <td class="line-number" value="530"></td>
               <td class="line-content">                ctx.fillStyle = '#cc00cc';</td>
            </tr>
            <tr>
               <td class="line-number" value="531"></td>
               <td class="line-content">                ctx.fillRect(this.x, this.y + 15, this.width, 10);</td>
            </tr>
            <tr>
               <td class="line-number" value="532"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="533"></td>
               <td class="line-content">                // Add some lights</td>
            </tr>
            <tr>
               <td class="line-number" value="534"></td>
               <td class="line-content">                ctx.fillStyle = '#ffff00';</td>
            </tr>
            <tr>
               <td class="line-number" value="535"></td>
               <td class="line-content">                for (let i = 0; i &lt; 4; i++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="536"></td>
               <td class="line-content">                    ctx.fillRect(this.x + 8 + i * 12, this.y + 18, 4, 4);</td>
            </tr>
            <tr>
               <td class="line-number" value="537"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="538"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="539"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="540"></td>
               <td class="line-content">            isOffScreen() {</td>
            </tr>
            <tr>
               <td class="line-number" value="541"></td>
               <td class="line-content">                return (this.direction === 1 &amp;&amp; this.x &gt; canvas.width) || </td>
            </tr>
            <tr>
               <td class="line-number" value="542"></td>
               <td class="line-content">                       (this.direction === -1 &amp;&amp; this.x &lt; -this.width);</td>
            </tr>
            <tr>
               <td class="line-number" value="543"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="544"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="545"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="546"></td>
               <td class="line-content">        // Initialize invaders based on stage (for preview or actual game)</td>
            </tr>
            <tr>
               <td class="line-number" value="547"></td>
               <td class="line-content">        function createInvaders(stage = currentStage) {</td>
            </tr>
            <tr>
               <td class="line-number" value="548"></td>
               <td class="line-content">            invaders = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="549"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="550"></td>
               <td class="line-content">            switch(stage) {</td>
            </tr>
            <tr>
               <td class="line-number" value="551"></td>
               <td class="line-content">                case 1:</td>
            </tr>
            <tr>
               <td class="line-number" value="552"></td>
               <td class="line-content">                    // 3 rows of small invaders</td>
            </tr>
            <tr>
               <td class="line-number" value="553"></td>
               <td class="line-content">                    for (let row = 0; row &lt; 3; row++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="554"></td>
               <td class="line-content">                        for (let col = 0; col &lt; 10; col++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="555"></td>
               <td class="line-content">                            invaders.push(new Invader(col * 60 + 50, row * 50 + 50, 1));</td>
            </tr>
            <tr>
               <td class="line-number" value="556"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="557"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="558"></td>
               <td class="line-content">                    break;</td>
            </tr>
            <tr>
               <td class="line-number" value="559"></td>
               <td class="line-content">                case 2:</td>
            </tr>
            <tr>
               <td class="line-number" value="560"></td>
               <td class="line-content">                    // 4 rows of medium invaders</td>
            </tr>
            <tr>
               <td class="line-number" value="561"></td>
               <td class="line-content">                    for (let row = 0; row &lt; 4; row++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="562"></td>
               <td class="line-content">                        for (let col = 0; col &lt; 8; col++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="563"></td>
               <td class="line-content">                            invaders.push(new Invader(col * 80 + 60, row * 60 + 50, 2));</td>
            </tr>
            <tr>
               <td class="line-number" value="564"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="565"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="566"></td>
               <td class="line-content">                    break;</td>
            </tr>
            <tr>
               <td class="line-number" value="567"></td>
               <td class="line-content">                case 3:</td>
            </tr>
            <tr>
               <td class="line-number" value="568"></td>
               <td class="line-content">                    // 4 big invaders in a 2x2 formation</td>
            </tr>
            <tr>
               <td class="line-number" value="569"></td>
               <td class="line-content">                    for (let row = 0; row &lt; 2; row++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="570"></td>
               <td class="line-content">                        for (let col = 0; col &lt; 2; col++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="571"></td>
               <td class="line-content">                            invaders.push(new Invader(col * 200 + 200, row * 100 + 80, 3));</td>
            </tr>
            <tr>
               <td class="line-number" value="572"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="573"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="574"></td>
               <td class="line-content">                    break;</td>
            </tr>
            <tr>
               <td class="line-number" value="575"></td>
               <td class="line-content">                case 4:</td>
            </tr>
            <tr>
               <td class="line-number" value="576"></td>
               <td class="line-content">                    // 1 giant boss monster</td>
            </tr>
            <tr>
               <td class="line-number" value="577"></td>
               <td class="line-content">                    invaders.push(new Invader(canvas.width/2 - 60, 100, 4));</td>
            </tr>
            <tr>
               <td class="line-number" value="578"></td>
               <td class="line-content">                    break;</td>
            </tr>
            <tr>
               <td class="line-number" value="579"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="580"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="581"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="582"></td>
               <td class="line-content">        // Initialize barriers</td>
            </tr>
            <tr>
               <td class="line-number" value="583"></td>
               <td class="line-content">        function createBarriers() {</td>
            </tr>
            <tr>
               <td class="line-number" value="584"></td>
               <td class="line-content">            barriers = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="585"></td>
               <td class="line-content">            const barrierCount = 4;</td>
            </tr>
            <tr>
               <td class="line-number" value="586"></td>
               <td class="line-content">            const barrierSpacing = canvas.width / (barrierCount + 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="587"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="588"></td>
               <td class="line-content">            for (let i = 0; i &lt; barrierCount; i++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="589"></td>
               <td class="line-content">                const x = barrierSpacing * (i + 1) - 40; // Center the barrier</td>
            </tr>
            <tr>
               <td class="line-number" value="590"></td>
               <td class="line-content">                const y = canvas.height - 200; // Position between player and invaders</td>
            </tr>
            <tr>
               <td class="line-number" value="591"></td>
               <td class="line-content">                barriers.push(new Barrier(x, y));</td>
            </tr>
            <tr>
               <td class="line-number" value="592"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="593"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="594"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="595"></td>
               <td class="line-content">        // Handle keyboard input</td>
            </tr>
            <tr>
               <td class="line-number" value="596"></td>
               <td class="line-content">        document.addEventListener('keydown', (e) =&gt; {</td>
            </tr>
            <tr>
               <td class="line-number" value="597"></td>
               <td class="line-content">            keys[e.code] = true;</td>
            </tr>
            <tr>
               <td class="line-number" value="598"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="599"></td>
               <td class="line-content">            if (e.code === 'Space') {</td>
            </tr>
            <tr>
               <td class="line-number" value="600"></td>
               <td class="line-content">                e.preventDefault();</td>
            </tr>
            <tr>
               <td class="line-number" value="601"></td>
               <td class="line-content">                if (gameRunning) {</td>
            </tr>
            <tr>
               <td class="line-number" value="602"></td>
               <td class="line-content">                    bullets.push(new Bullet(player.x + player.width/2, player.y, -7));</td>
            </tr>
            <tr>
               <td class="line-number" value="603"></td>
               <td class="line-content">                    playPlayerShootSound();</td>
            </tr>
            <tr>
               <td class="line-number" value="604"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="605"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="606"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="607"></td>
               <td class="line-content">            if (e.code === 'KeyR') {</td>
            </tr>
            <tr>
               <td class="line-number" value="608"></td>
               <td class="line-content">                if (!gameStarted) {</td>
            </tr>
            <tr>
               <td class="line-number" value="609"></td>
               <td class="line-content">                    startGame();</td>
            </tr>
            <tr>
               <td class="line-number" value="610"></td>
               <td class="line-content">                } else if (!isNewRecord) {</td>
            </tr>
            <tr>
               <td class="line-number" value="611"></td>
               <td class="line-content">                    restartGame();</td>
            </tr>
            <tr>
               <td class="line-number" value="612"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="613"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="614"></td>
               <td class="line-content">        });</td>
            </tr>
            <tr>
               <td class="line-number" value="615"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="616"></td>
               <td class="line-content">        // Handle score submission</td>
            </tr>
            <tr>
               <td class="line-number" value="617"></td>
               <td class="line-content">        submitScoreButton.addEventListener('click', submitScore);</td>
            </tr>
            <tr>
               <td class="line-number" value="618"></td>
               <td class="line-content">        playerNameInput.addEventListener('keypress', (e) =&gt; {</td>
            </tr>
            <tr>
               <td class="line-number" value="619"></td>
               <td class="line-content">            if (e.key === 'Enter') {</td>
            </tr>
            <tr>
               <td class="line-number" value="620"></td>
               <td class="line-content">                submitScore();</td>
            </tr>
            <tr>
               <td class="line-number" value="621"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="622"></td>
               <td class="line-content">        });</td>
            </tr>
            <tr>
               <td class="line-number" value="623"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="624"></td>
               <td class="line-content">        document.addEventListener('keyup', (e) =&gt; {</td>
            </tr>
            <tr>
               <td class="line-number" value="625"></td>
               <td class="line-content">            keys[e.code] = false;</td>
            </tr>
            <tr>
               <td class="line-number" value="626"></td>
               <td class="line-content">        });</td>
            </tr>
            <tr>
               <td class="line-number" value="627"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="628"></td>
               <td class="line-content">        // Initialize audio context</td>
            </tr>
            <tr>
               <td class="line-number" value="629"></td>
               <td class="line-content">        function initAudio() {</td>
            </tr>
            <tr>
               <td class="line-number" value="630"></td>
               <td class="line-content">            if (!audioContext) {</td>
            </tr>
            <tr>
               <td class="line-number" value="631"></td>
               <td class="line-content">                audioContext = new (window.AudioContext || window.webkitAudioContext)();</td>
            </tr>
            <tr>
               <td class="line-number" value="632"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="633"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="634"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="635"></td>
               <td class="line-content">        // Sound generation functions</td>
            </tr>
            <tr>
               <td class="line-number" value="636"></td>
               <td class="line-content">        function playPlayerShootSound() {</td>
            </tr>
            <tr>
               <td class="line-number" value="637"></td>
               <td class="line-content">            initAudio();</td>
            </tr>
            <tr>
               <td class="line-number" value="638"></td>
               <td class="line-content">            const oscillator = audioContext.createOscillator();</td>
            </tr>
            <tr>
               <td class="line-number" value="639"></td>
               <td class="line-content">            const gainNode = audioContext.createGain();</td>
            </tr>
            <tr>
               <td class="line-number" value="640"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="641"></td>
               <td class="line-content">            oscillator.connect(gainNode);</td>
            </tr>
            <tr>
               <td class="line-number" value="642"></td>
               <td class="line-content">            gainNode.connect(audioContext.destination);</td>
            </tr>
            <tr>
               <td class="line-number" value="643"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="644"></td>
               <td class="line-content">            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="645"></td>
               <td class="line-content">            oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.1);</td>
            </tr>
            <tr>
               <td class="line-number" value="646"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="647"></td>
               <td class="line-content">            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="648"></td>
               <td class="line-content">            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);</td>
            </tr>
            <tr>
               <td class="line-number" value="649"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="650"></td>
               <td class="line-content">            oscillator.start(audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="651"></td>
               <td class="line-content">            oscillator.stop(audioContext.currentTime + 0.1);</td>
            </tr>
            <tr>
               <td class="line-number" value="652"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="653"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="654"></td>
               <td class="line-content">        function playInvaderMoveSound(stage) {</td>
            </tr>
            <tr>
               <td class="line-number" value="655"></td>
               <td class="line-content">            initAudio();</td>
            </tr>
            <tr>
               <td class="line-number" value="656"></td>
               <td class="line-content">            const oscillator = audioContext.createOscillator();</td>
            </tr>
            <tr>
               <td class="line-number" value="657"></td>
               <td class="line-content">            const gainNode = audioContext.createGain();</td>
            </tr>
            <tr>
               <td class="line-number" value="658"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="659"></td>
               <td class="line-content">            oscillator.connect(gainNode);</td>
            </tr>
            <tr>
               <td class="line-number" value="660"></td>
               <td class="line-content">            gainNode.connect(audioContext.destination);</td>
            </tr>
            <tr>
               <td class="line-number" value="661"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="662"></td>
               <td class="line-content">            // Different frequencies for different stages</td>
            </tr>
            <tr>
               <td class="line-number" value="663"></td>
               <td class="line-content">            const frequencies = [150, 180, 120, 100];</td>
            </tr>
            <tr>
               <td class="line-number" value="664"></td>
               <td class="line-content">            oscillator.frequency.setValueAtTime(frequencies[stage - 1], audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="665"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="666"></td>
               <td class="line-content">            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="667"></td>
               <td class="line-content">            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);</td>
            </tr>
            <tr>
               <td class="line-number" value="668"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="669"></td>
               <td class="line-content">            oscillator.start(audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="670"></td>
               <td class="line-content">            oscillator.stop(audioContext.currentTime + 0.05);</td>
            </tr>
            <tr>
               <td class="line-number" value="671"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="672"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="673"></td>
               <td class="line-content">        function playInvaderHitSound(stage) {</td>
            </tr>
            <tr>
               <td class="line-number" value="674"></td>
               <td class="line-content">            initAudio();</td>
            </tr>
            <tr>
               <td class="line-number" value="675"></td>
               <td class="line-content">            const oscillator = audioContext.createOscillator();</td>
            </tr>
            <tr>
               <td class="line-number" value="676"></td>
               <td class="line-content">            const gainNode = audioContext.createGain();</td>
            </tr>
            <tr>
               <td class="line-number" value="677"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="678"></td>
               <td class="line-content">            oscillator.connect(gainNode);</td>
            </tr>
            <tr>
               <td class="line-number" value="679"></td>
               <td class="line-content">            gainNode.connect(audioContext.destination);</td>
            </tr>
            <tr>
               <td class="line-number" value="680"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="681"></td>
               <td class="line-content">            // Different hit sounds for different stages</td>
            </tr>
            <tr>
               <td class="line-number" value="682"></td>
               <td class="line-content">            const frequencies = [400, 350, 300, 250];</td>
            </tr>
            <tr>
               <td class="line-number" value="683"></td>
               <td class="line-content">            oscillator.frequency.setValueAtTime(frequencies[stage - 1], audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="684"></td>
               <td class="line-content">            oscillator.frequency.exponentialRampToValueAtTime(frequencies[stage - 1] * 0.5, audioContext.currentTime + 0.2);</td>
            </tr>
            <tr>
               <td class="line-number" value="685"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="686"></td>
               <td class="line-content">            gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="687"></td>
               <td class="line-content">            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);</td>
            </tr>
            <tr>
               <td class="line-number" value="688"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="689"></td>
               <td class="line-content">            oscillator.start(audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="690"></td>
               <td class="line-content">            oscillator.stop(audioContext.currentTime + 0.2);</td>
            </tr>
            <tr>
               <td class="line-number" value="691"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="692"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="693"></td>
               <td class="line-content">        function playInvaderDeathSound(stage) {</td>
            </tr>
            <tr>
               <td class="line-number" value="694"></td>
               <td class="line-content">            initAudio();</td>
            </tr>
            <tr>
               <td class="line-number" value="695"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="696"></td>
               <td class="line-content">            // Create explosion-like sound with multiple oscillators</td>
            </tr>
            <tr>
               <td class="line-number" value="697"></td>
               <td class="line-content">            for (let i = 0; i &lt; 3; i++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="698"></td>
               <td class="line-content">                const oscillator = audioContext.createOscillator();</td>
            </tr>
            <tr>
               <td class="line-number" value="699"></td>
               <td class="line-content">                const gainNode = audioContext.createGain();</td>
            </tr>
            <tr>
               <td class="line-number" value="700"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="701"></td>
               <td class="line-content">                oscillator.connect(gainNode);</td>
            </tr>
            <tr>
               <td class="line-number" value="702"></td>
               <td class="line-content">                gainNode.connect(audioContext.destination);</td>
            </tr>
            <tr>
               <td class="line-number" value="703"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="704"></td>
               <td class="line-content">                // Different death sounds for different stages</td>
            </tr>
            <tr>
               <td class="line-number" value="705"></td>
               <td class="line-content">                const baseFreqs = [600, 500, 400, 300];</td>
            </tr>
            <tr>
               <td class="line-number" value="706"></td>
               <td class="line-content">                const freq = baseFreqs[stage - 1] + (i * 100);</td>
            </tr>
            <tr>
               <td class="line-number" value="707"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="708"></td>
               <td class="line-content">                oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="709"></td>
               <td class="line-content">                oscillator.frequency.exponentialRampToValueAtTime(freq * 0.1, audioContext.currentTime + 0.3);</td>
            </tr>
            <tr>
               <td class="line-number" value="710"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="711"></td>
               <td class="line-content">                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="712"></td>
               <td class="line-content">                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);</td>
            </tr>
            <tr>
               <td class="line-number" value="713"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="714"></td>
               <td class="line-content">                oscillator.start(audioContext.currentTime + i * 0.05);</td>
            </tr>
            <tr>
               <td class="line-number" value="715"></td>
               <td class="line-content">                oscillator.stop(audioContext.currentTime + 0.3);</td>
            </tr>
            <tr>
               <td class="line-number" value="716"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="717"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="718"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="719"></td>
               <td class="line-content">        function startUFOSound() {</td>
            </tr>
            <tr>
               <td class="line-number" value="720"></td>
               <td class="line-content">            if (ufoSoundInterval) return;</td>
            </tr>
            <tr>
               <td class="line-number" value="721"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="722"></td>
               <td class="line-content">            initAudio();</td>
            </tr>
            <tr>
               <td class="line-number" value="723"></td>
               <td class="line-content">            ufoSoundInterval = setInterval(() =&gt; {</td>
            </tr>
            <tr>
               <td class="line-number" value="724"></td>
               <td class="line-content">                const oscillator = audioContext.createOscillator();</td>
            </tr>
            <tr>
               <td class="line-number" value="725"></td>
               <td class="line-content">                const gainNode = audioContext.createGain();</td>
            </tr>
            <tr>
               <td class="line-number" value="726"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="727"></td>
               <td class="line-content">                oscillator.connect(gainNode);</td>
            </tr>
            <tr>
               <td class="line-number" value="728"></td>
               <td class="line-content">                gainNode.connect(audioContext.destination);</td>
            </tr>
            <tr>
               <td class="line-number" value="729"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="730"></td>
               <td class="line-content">                oscillator.frequency.setValueAtTime(220, audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="731"></td>
               <td class="line-content">                oscillator.frequency.setValueAtTime(330, audioContext.currentTime + 0.1);</td>
            </tr>
            <tr>
               <td class="line-number" value="732"></td>
               <td class="line-content">                oscillator.frequency.setValueAtTime(220, audioContext.currentTime + 0.2);</td>
            </tr>
            <tr>
               <td class="line-number" value="733"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="734"></td>
               <td class="line-content">                gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="735"></td>
               <td class="line-content">                gainNode.gain.setValueAtTime(0.15, audioContext.currentTime + 0.2);</td>
            </tr>
            <tr>
               <td class="line-number" value="736"></td>
               <td class="line-content">                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);</td>
            </tr>
            <tr>
               <td class="line-number" value="737"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="738"></td>
               <td class="line-content">                oscillator.start(audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="739"></td>
               <td class="line-content">                oscillator.stop(audioContext.currentTime + 0.3);</td>
            </tr>
            <tr>
               <td class="line-number" value="740"></td>
               <td class="line-content">            }, 400);</td>
            </tr>
            <tr>
               <td class="line-number" value="741"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="742"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="743"></td>
               <td class="line-content">        function stopUFOSound() {</td>
            </tr>
            <tr>
               <td class="line-number" value="744"></td>
               <td class="line-content">            if (ufoSoundInterval) {</td>
            </tr>
            <tr>
               <td class="line-number" value="745"></td>
               <td class="line-content">                clearInterval(ufoSoundInterval);</td>
            </tr>
            <tr>
               <td class="line-number" value="746"></td>
               <td class="line-content">                ufoSoundInterval = null;</td>
            </tr>
            <tr>
               <td class="line-number" value="747"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="748"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="749"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="750"></td>
               <td class="line-content">        function playUFODestroySound() {</td>
            </tr>
            <tr>
               <td class="line-number" value="751"></td>
               <td class="line-content">            initAudio();</td>
            </tr>
            <tr>
               <td class="line-number" value="752"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="753"></td>
               <td class="line-content">            // Create a satisfying UFO destruction sound</td>
            </tr>
            <tr>
               <td class="line-number" value="754"></td>
               <td class="line-content">            for (let i = 0; i &lt; 4; i++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="755"></td>
               <td class="line-content">                const oscillator = audioContext.createOscillator();</td>
            </tr>
            <tr>
               <td class="line-number" value="756"></td>
               <td class="line-content">                const gainNode = audioContext.createGain();</td>
            </tr>
            <tr>
               <td class="line-number" value="757"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="758"></td>
               <td class="line-content">                oscillator.connect(gainNode);</td>
            </tr>
            <tr>
               <td class="line-number" value="759"></td>
               <td class="line-content">                gainNode.connect(audioContext.destination);</td>
            </tr>
            <tr>
               <td class="line-number" value="760"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="761"></td>
               <td class="line-content">                const freq = 800 - (i * 150);</td>
            </tr>
            <tr>
               <td class="line-number" value="762"></td>
               <td class="line-content">                oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="763"></td>
               <td class="line-content">                oscillator.frequency.exponentialRampToValueAtTime(freq * 0.2, audioContext.currentTime + 0.4);</td>
            </tr>
            <tr>
               <td class="line-number" value="764"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="765"></td>
               <td class="line-content">                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="766"></td>
               <td class="line-content">                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);</td>
            </tr>
            <tr>
               <td class="line-number" value="767"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="768"></td>
               <td class="line-content">                oscillator.start(audioContext.currentTime + i * 0.1);</td>
            </tr>
            <tr>
               <td class="line-number" value="769"></td>
               <td class="line-content">                oscillator.stop(audioContext.currentTime + 0.4);</td>
            </tr>
            <tr>
               <td class="line-number" value="770"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="771"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="772"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="773"></td>
               <td class="line-content">        function playStageClearSound() {</td>
            </tr>
            <tr>
               <td class="line-number" value="774"></td>
               <td class="line-content">            initAudio();</td>
            </tr>
            <tr>
               <td class="line-number" value="775"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="776"></td>
               <td class="line-content">            // Happy stage clear melody</td>
            </tr>
            <tr>
               <td class="line-number" value="777"></td>
               <td class="line-content">            const notes = [523, 659, 784, 1047]; // C5, E5, G5, C6</td>
            </tr>
            <tr>
               <td class="line-number" value="778"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="779"></td>
               <td class="line-content">            notes.forEach((freq, index) =&gt; {</td>
            </tr>
            <tr>
               <td class="line-number" value="780"></td>
               <td class="line-content">                const oscillator = audioContext.createOscillator();</td>
            </tr>
            <tr>
               <td class="line-number" value="781"></td>
               <td class="line-content">                const gainNode = audioContext.createGain();</td>
            </tr>
            <tr>
               <td class="line-number" value="782"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="783"></td>
               <td class="line-content">                oscillator.connect(gainNode);</td>
            </tr>
            <tr>
               <td class="line-number" value="784"></td>
               <td class="line-content">                gainNode.connect(audioContext.destination);</td>
            </tr>
            <tr>
               <td class="line-number" value="785"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="786"></td>
               <td class="line-content">                oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="787"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="788"></td>
               <td class="line-content">                gainNode.gain.setValueAtTime(0.4, audioContext.currentTime + index * 0.2);</td>
            </tr>
            <tr>
               <td class="line-number" value="789"></td>
               <td class="line-content">                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + index * 0.2 + 0.3);</td>
            </tr>
            <tr>
               <td class="line-number" value="790"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="791"></td>
               <td class="line-content">                oscillator.start(audioContext.currentTime + index * 0.2);</td>
            </tr>
            <tr>
               <td class="line-number" value="792"></td>
               <td class="line-content">                oscillator.stop(audioContext.currentTime + index * 0.2 + 0.3);</td>
            </tr>
            <tr>
               <td class="line-number" value="793"></td>
               <td class="line-content">            });</td>
            </tr>
            <tr>
               <td class="line-number" value="794"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="795"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="796"></td>
               <td class="line-content">        function playGameCompleteSound() {</td>
            </tr>
            <tr>
               <td class="line-number" value="797"></td>
               <td class="line-content">            initAudio();</td>
            </tr>
            <tr>
               <td class="line-number" value="798"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="799"></td>
               <td class="line-content">            // Victory fanfare</td>
            </tr>
            <tr>
               <td class="line-number" value="800"></td>
               <td class="line-content">            const melody = [</td>
            </tr>
            <tr>
               <td class="line-number" value="801"></td>
               <td class="line-content">                {freq: 523, time: 0},    // C5</td>
            </tr>
            <tr>
               <td class="line-number" value="802"></td>
               <td class="line-content">                {freq: 659, time: 0.3},  // E5</td>
            </tr>
            <tr>
               <td class="line-number" value="803"></td>
               <td class="line-content">                {freq: 784, time: 0.6},  // G5</td>
            </tr>
            <tr>
               <td class="line-number" value="804"></td>
               <td class="line-content">                {freq: 1047, time: 0.9}, // C6</td>
            </tr>
            <tr>
               <td class="line-number" value="805"></td>
               <td class="line-content">                {freq: 784, time: 1.2},  // G5</td>
            </tr>
            <tr>
               <td class="line-number" value="806"></td>
               <td class="line-content">                {freq: 1047, time: 1.5}, // C6</td>
            </tr>
            <tr>
               <td class="line-number" value="807"></td>
               <td class="line-content">                {freq: 1319, time: 1.8}, // E6</td>
            </tr>
            <tr>
               <td class="line-number" value="808"></td>
               <td class="line-content">                {freq: 1568, time: 2.1}  // G6</td>
            </tr>
            <tr>
               <td class="line-number" value="809"></td>
               <td class="line-content">            ];</td>
            </tr>
            <tr>
               <td class="line-number" value="810"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="811"></td>
               <td class="line-content">            melody.forEach(note =&gt; {</td>
            </tr>
            <tr>
               <td class="line-number" value="812"></td>
               <td class="line-content">                const oscillator = audioContext.createOscillator();</td>
            </tr>
            <tr>
               <td class="line-number" value="813"></td>
               <td class="line-content">                const gainNode = audioContext.createGain();</td>
            </tr>
            <tr>
               <td class="line-number" value="814"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="815"></td>
               <td class="line-content">                oscillator.connect(gainNode);</td>
            </tr>
            <tr>
               <td class="line-number" value="816"></td>
               <td class="line-content">                gainNode.connect(audioContext.destination);</td>
            </tr>
            <tr>
               <td class="line-number" value="817"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="818"></td>
               <td class="line-content">                oscillator.frequency.setValueAtTime(note.freq, audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="819"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="820"></td>
               <td class="line-content">                gainNode.gain.setValueAtTime(0.5, audioContext.currentTime + note.time);</td>
            </tr>
            <tr>
               <td class="line-number" value="821"></td>
               <td class="line-content">                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + note.time + 0.4);</td>
            </tr>
            <tr>
               <td class="line-number" value="822"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="823"></td>
               <td class="line-content">                oscillator.start(audioContext.currentTime + note.time);</td>
            </tr>
            <tr>
               <td class="line-number" value="824"></td>
               <td class="line-content">                oscillator.stop(audioContext.currentTime + note.time + 0.4);</td>
            </tr>
            <tr>
               <td class="line-number" value="825"></td>
               <td class="line-content">            });</td>
            </tr>
            <tr>
               <td class="line-number" value="826"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="827"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="828"></td>
               <td class="line-content">        function playGameOverSound() {</td>
            </tr>
            <tr>
               <td class="line-number" value="829"></td>
               <td class="line-content">            initAudio();</td>
            </tr>
            <tr>
               <td class="line-number" value="830"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="831"></td>
               <td class="line-content">            // Sad game over sound - descending notes</td>
            </tr>
            <tr>
               <td class="line-number" value="832"></td>
               <td class="line-content">            const notes = [523, 466, 415, 349, 294]; // C5 down to D4</td>
            </tr>
            <tr>
               <td class="line-number" value="833"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="834"></td>
               <td class="line-content">            notes.forEach((freq, index) =&gt; {</td>
            </tr>
            <tr>
               <td class="line-number" value="835"></td>
               <td class="line-content">                const oscillator = audioContext.createOscillator();</td>
            </tr>
            <tr>
               <td class="line-number" value="836"></td>
               <td class="line-content">                const gainNode = audioContext.createGain();</td>
            </tr>
            <tr>
               <td class="line-number" value="837"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="838"></td>
               <td class="line-content">                oscillator.connect(gainNode);</td>
            </tr>
            <tr>
               <td class="line-number" value="839"></td>
               <td class="line-content">                gainNode.connect(audioContext.destination);</td>
            </tr>
            <tr>
               <td class="line-number" value="840"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="841"></td>
               <td class="line-content">                oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);</td>
            </tr>
            <tr>
               <td class="line-number" value="842"></td>
               <td class="line-content">                oscillator.frequency.exponentialRampToValueAtTime(freq * 0.8, audioContext.currentTime + 0.5);</td>
            </tr>
            <tr>
               <td class="line-number" value="843"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="844"></td>
               <td class="line-content">                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime + index * 0.3);</td>
            </tr>
            <tr>
               <td class="line-number" value="845"></td>
               <td class="line-content">                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + index * 0.3 + 0.5);</td>
            </tr>
            <tr>
               <td class="line-number" value="846"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="847"></td>
               <td class="line-content">                oscillator.start(audioContext.currentTime + index * 0.3);</td>
            </tr>
            <tr>
               <td class="line-number" value="848"></td>
               <td class="line-content">                oscillator.stop(audioContext.currentTime + index * 0.3 + 0.5);</td>
            </tr>
            <tr>
               <td class="line-number" value="849"></td>
               <td class="line-content">            });</td>
            </tr>
            <tr>
               <td class="line-number" value="850"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="851"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="852"></td>
               <td class="line-content">        // Ranking system functions</td>
            </tr>
            <tr>
               <td class="line-number" value="853"></td>
               <td class="line-content">        function loadRankings() {</td>
            </tr>
            <tr>
               <td class="line-number" value="854"></td>
               <td class="line-content">            const saved = localStorage.getItem('spaceInvadersRankings');</td>
            </tr>
            <tr>
               <td class="line-number" value="855"></td>
               <td class="line-content">            if (saved) {</td>
            </tr>
            <tr>
               <td class="line-number" value="856"></td>
               <td class="line-content">                rankings = JSON.parse(saved);</td>
            </tr>
            <tr>
               <td class="line-number" value="857"></td>
               <td class="line-content">            } else {</td>
            </tr>
            <tr>
               <td class="line-number" value="858"></td>
               <td class="line-content">                // Initialize with default rankings</td>
            </tr>
            <tr>
               <td class="line-number" value="859"></td>
               <td class="line-content">                rankings = [</td>
            </tr>
            <tr>
               <td class="line-number" value="860"></td>
               <td class="line-content">                    {name: "ALIEN", score: 1000},</td>
            </tr>
            <tr>
               <td class="line-number" value="861"></td>
               <td class="line-content">                    {name: "INVADER", score: 500},</td>
            </tr>
            <tr>
               <td class="line-number" value="862"></td>
               <td class="line-content">                    {name: "UFO", score: 100}</td>
            </tr>
            <tr>
               <td class="line-number" value="863"></td>
               <td class="line-content">                ];</td>
            </tr>
            <tr>
               <td class="line-number" value="864"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="865"></td>
               <td class="line-content">            displayRankings();</td>
            </tr>
            <tr>
               <td class="line-number" value="866"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="867"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="868"></td>
               <td class="line-content">        function saveRankings() {</td>
            </tr>
            <tr>
               <td class="line-number" value="869"></td>
               <td class="line-content">            localStorage.setItem('spaceInvadersRankings', JSON.stringify(rankings));</td>
            </tr>
            <tr>
               <td class="line-number" value="870"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="871"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="872"></td>
               <td class="line-content">        function displayRankings() {</td>
            </tr>
            <tr>
               <td class="line-number" value="873"></td>
               <td class="line-content">            let html = '';</td>
            </tr>
            <tr>
               <td class="line-number" value="874"></td>
               <td class="line-content">            for (let i = 0; i &lt; Math.min(3, rankings.length); i++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="875"></td>
               <td class="line-content">                const rank = i + 1;</td>
            </tr>
            <tr>
               <td class="line-number" value="876"></td>
               <td class="line-content">                const medal = rank === 1 ? '🥇' : rank === 2 ? '🥈' : '🥉';</td>
            </tr>
            <tr>
               <td class="line-number" value="877"></td>
               <td class="line-content">                html += `&lt;div style="margin: 5px 0;"&gt;${medal} ${rank}. ${rankings[i].name} - ${rankings[i].score}&lt;/div&gt;`;</td>
            </tr>
            <tr>
               <td class="line-number" value="878"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="879"></td>
               <td class="line-content">            rankingListElement.innerHTML = html;</td>
            </tr>
            <tr>
               <td class="line-number" value="880"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="881"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="882"></td>
               <td class="line-content">        function checkNewRecord(finalScore) {</td>
            </tr>
            <tr>
               <td class="line-number" value="883"></td>
               <td class="line-content">            // Check if score qualifies for top 3</td>
            </tr>
            <tr>
               <td class="line-number" value="884"></td>
               <td class="line-content">            if (rankings.length &lt; 3 || finalScore &gt; rankings[2].score) {</td>
            </tr>
            <tr>
               <td class="line-number" value="885"></td>
               <td class="line-content">                return true;</td>
            </tr>
            <tr>
               <td class="line-number" value="886"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="887"></td>
               <td class="line-content">            return false;</td>
            </tr>
            <tr>
               <td class="line-number" value="888"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="889"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="890"></td>
               <td class="line-content">        function submitScore() {</td>
            </tr>
            <tr>
               <td class="line-number" value="891"></td>
               <td class="line-content">            const playerName = playerNameInput.value.trim() || "ANONYMOUS";</td>
            </tr>
            <tr>
               <td class="line-number" value="892"></td>
               <td class="line-content">            const newEntry = {name: playerName.toUpperCase(), score: score};</td>
            </tr>
            <tr>
               <td class="line-number" value="893"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="894"></td>
               <td class="line-content">            // Add new score and sort</td>
            </tr>
            <tr>
               <td class="line-number" value="895"></td>
               <td class="line-content">            rankings.push(newEntry);</td>
            </tr>
            <tr>
               <td class="line-number" value="896"></td>
               <td class="line-content">            rankings.sort((a, b) =&gt; b.score - a.score);</td>
            </tr>
            <tr>
               <td class="line-number" value="897"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="898"></td>
               <td class="line-content">            // Keep only top 3</td>
            </tr>
            <tr>
               <td class="line-number" value="899"></td>
               <td class="line-content">            rankings = rankings.slice(0, 3);</td>
            </tr>
            <tr>
               <td class="line-number" value="900"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="901"></td>
               <td class="line-content">            // Save and display</td>
            </tr>
            <tr>
               <td class="line-number" value="902"></td>
               <td class="line-content">            saveRankings();</td>
            </tr>
            <tr>
               <td class="line-number" value="903"></td>
               <td class="line-content">            displayRankings();</td>
            </tr>
            <tr>
               <td class="line-number" value="904"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="905"></td>
               <td class="line-content">            // Hide new record input</td>
            </tr>
            <tr>
               <td class="line-number" value="906"></td>
               <td class="line-content">            newRecordElement.style.display = 'none';</td>
            </tr>
            <tr>
               <td class="line-number" value="907"></td>
               <td class="line-content">            isNewRecord = false;</td>
            </tr>
            <tr>
               <td class="line-number" value="908"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="909"></td>
               <td class="line-content">            // Show appropriate completion message</td>
            </tr>
            <tr>
               <td class="line-number" value="910"></td>
               <td class="line-content">            if (isGameComplete) {</td>
            </tr>
            <tr>
               <td class="line-number" value="911"></td>
               <td class="line-content">                gameCompleteElement.style.display = 'block';</td>
            </tr>
            <tr>
               <td class="line-number" value="912"></td>
               <td class="line-content">            } else {</td>
            </tr>
            <tr>
               <td class="line-number" value="913"></td>
               <td class="line-content">                gameOverElement.style.display = 'block';</td>
            </tr>
            <tr>
               <td class="line-number" value="914"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="915"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="916"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="917"></td>
               <td class="line-content">        // Update player position</td>
            </tr>
            <tr>
               <td class="line-number" value="918"></td>
               <td class="line-content">        function updatePlayer() {</td>
            </tr>
            <tr>
               <td class="line-number" value="919"></td>
               <td class="line-content">            if (keys['ArrowLeft'] &amp;&amp; player.x &gt; 0) {</td>
            </tr>
            <tr>
               <td class="line-number" value="920"></td>
               <td class="line-content">                player.x -= player.speed;</td>
            </tr>
            <tr>
               <td class="line-number" value="921"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="922"></td>
               <td class="line-content">            if (keys['ArrowRight'] &amp;&amp; player.x &lt; canvas.width - player.width) {</td>
            </tr>
            <tr>
               <td class="line-number" value="923"></td>
               <td class="line-content">                player.x += player.speed;</td>
            </tr>
            <tr>
               <td class="line-number" value="924"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="925"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="926"></td>
               <td class="line-content">            // Update invulnerability timer</td>
            </tr>
            <tr>
               <td class="line-number" value="927"></td>
               <td class="line-content">            if (invulnerabilityTimer &gt; 0) {</td>
            </tr>
            <tr>
               <td class="line-number" value="928"></td>
               <td class="line-content">                invulnerabilityTimer--;</td>
            </tr>
            <tr>
               <td class="line-number" value="929"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="930"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="931"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="932"></td>
               <td class="line-content">        // Draw player</td>
            </tr>
            <tr>
               <td class="line-number" value="933"></td>
               <td class="line-content">        function drawPlayer() {</td>
            </tr>
            <tr>
               <td class="line-number" value="934"></td>
               <td class="line-content">            // Flash player when invulnerable</td>
            </tr>
            <tr>
               <td class="line-number" value="935"></td>
               <td class="line-content">            if (invulnerabilityTimer &gt; 0 &amp;&amp; Math.floor(invulnerabilityTimer / 5) % 2 === 0) {</td>
            </tr>
            <tr>
               <td class="line-number" value="936"></td>
               <td class="line-content">                return; // Skip drawing to create flashing effect</td>
            </tr>
            <tr>
               <td class="line-number" value="937"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="938"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="939"></td>
               <td class="line-content">            ctx.fillStyle = player.color;</td>
            </tr>
            <tr>
               <td class="line-number" value="940"></td>
               <td class="line-content">            ctx.fillRect(player.x, player.y, player.width, player.height);</td>
            </tr>
            <tr>
               <td class="line-number" value="941"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="942"></td>
               <td class="line-content">            // Draw player cannon</td>
            </tr>
            <tr>
               <td class="line-number" value="943"></td>
               <td class="line-content">            ctx.fillRect(player.x + player.width/2 - 3, player.y - 10, 6, 10);</td>
            </tr>
            <tr>
               <td class="line-number" value="944"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="945"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="946"></td>
               <td class="line-content">        // Update bullets</td>
            </tr>
            <tr>
               <td class="line-number" value="947"></td>
               <td class="line-content">        function updateBullets() {</td>
            </tr>
            <tr>
               <td class="line-number" value="948"></td>
               <td class="line-content">            // Update player bullets</td>
            </tr>
            <tr>
               <td class="line-number" value="949"></td>
               <td class="line-content">            for (let i = bullets.length - 1; i &gt;= 0; i--) {</td>
            </tr>
            <tr>
               <td class="line-number" value="950"></td>
               <td class="line-content">                bullets[i].update();</td>
            </tr>
            <tr>
               <td class="line-number" value="951"></td>
               <td class="line-content">                if (bullets[i].isOffScreen()) {</td>
            </tr>
            <tr>
               <td class="line-number" value="952"></td>
               <td class="line-content">                    bullets.splice(i, 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="953"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="954"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="955"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="956"></td>
               <td class="line-content">            // Update invader bullets</td>
            </tr>
            <tr>
               <td class="line-number" value="957"></td>
               <td class="line-content">            for (let i = invaderBullets.length - 1; i &gt;= 0; i--) {</td>
            </tr>
            <tr>
               <td class="line-number" value="958"></td>
               <td class="line-content">                invaderBullets[i].update();</td>
            </tr>
            <tr>
               <td class="line-number" value="959"></td>
               <td class="line-content">                if (invaderBullets[i].isOffScreen()) {</td>
            </tr>
            <tr>
               <td class="line-number" value="960"></td>
               <td class="line-content">                    invaderBullets.splice(i, 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="961"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="962"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="963"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="964"></td>
               <td class="line-content">            // Update UFO bombs</td>
            </tr>
            <tr>
               <td class="line-number" value="965"></td>
               <td class="line-content">            for (let i = ufoBombs.length - 1; i &gt;= 0; i--) {</td>
            </tr>
            <tr>
               <td class="line-number" value="966"></td>
               <td class="line-content">                ufoBombs[i].update();</td>
            </tr>
            <tr>
               <td class="line-number" value="967"></td>
               <td class="line-content">                if (ufoBombs[i].isOffScreen()) {</td>
            </tr>
            <tr>
               <td class="line-number" value="968"></td>
               <td class="line-content">                    ufoBombs.splice(i, 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="969"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="970"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="971"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="972"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="973"></td>
               <td class="line-content">        // Update invaders</td>
            </tr>
            <tr>
               <td class="line-number" value="974"></td>
               <td class="line-content">        function updateInvaders() {</td>
            </tr>
            <tr>
               <td class="line-number" value="975"></td>
               <td class="line-content">            let changeDirection = false;</td>
            </tr>
            <tr>
               <td class="line-number" value="976"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="977"></td>
               <td class="line-content">            // Check if any invader hits the edge</td>
            </tr>
            <tr>
               <td class="line-number" value="978"></td>
               <td class="line-content">            for (let invader of invaders) {</td>
            </tr>
            <tr>
               <td class="line-number" value="979"></td>
               <td class="line-content">                if (invader.x &lt;= 0 || invader.x &gt;= canvas.width - invader.width) {</td>
            </tr>
            <tr>
               <td class="line-number" value="980"></td>
               <td class="line-content">                    changeDirection = true;</td>
            </tr>
            <tr>
               <td class="line-number" value="981"></td>
               <td class="line-content">                    break;</td>
            </tr>
            <tr>
               <td class="line-number" value="982"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="983"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="984"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="985"></td>
               <td class="line-content">            // Move invaders down and change direction</td>
            </tr>
            <tr>
               <td class="line-number" value="986"></td>
               <td class="line-content">            if (changeDirection) {</td>
            </tr>
            <tr>
               <td class="line-number" value="987"></td>
               <td class="line-content">                for (let invader of invaders) {</td>
            </tr>
            <tr>
               <td class="line-number" value="988"></td>
               <td class="line-content">                    invader.direction *= -1;</td>
            </tr>
            <tr>
               <td class="line-number" value="989"></td>
               <td class="line-content">                    invader.y += 20;</td>
            </tr>
            <tr>
               <td class="line-number" value="990"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="991"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="992"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="993"></td>
               <td class="line-content">            // Update each invader</td>
            </tr>
            <tr>
               <td class="line-number" value="994"></td>
               <td class="line-content">            for (let invader of invaders) {</td>
            </tr>
            <tr>
               <td class="line-number" value="995"></td>
               <td class="line-content">                invader.update();</td>
            </tr>
            <tr>
               <td class="line-number" value="996"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="997"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="998"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="999"></td>
               <td class="line-content">        // Update UFO</td>
            </tr>
            <tr>
               <td class="line-number" value="1000"></td>
               <td class="line-content">        function updateUFO() {</td>
            </tr>
            <tr>
               <td class="line-number" value="1001"></td>
               <td class="line-content">            // Spawn UFO occasionally</td>
            </tr>
            <tr>
               <td class="line-number" value="1002"></td>
               <td class="line-content">            ufoSpawnTimer--;</td>
            </tr>
            <tr>
               <td class="line-number" value="1003"></td>
               <td class="line-content">            if (ufoSpawnTimer &lt;= 0 &amp;&amp; !ufo &amp;&amp; Math.random() &lt; 0.01) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1004"></td>
               <td class="line-content">                ufo = new UFO();</td>
            </tr>
            <tr>
               <td class="line-number" value="1005"></td>
               <td class="line-content">                ufoSpawnTimer = Math.random() * 1500 + 1000; // Reset timer</td>
            </tr>
            <tr>
               <td class="line-number" value="1006"></td>
               <td class="line-content">                startUFOSound(); // Start UFO sound</td>
            </tr>
            <tr>
               <td class="line-number" value="1007"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1008"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1009"></td>
               <td class="line-content">            // Update existing UFO</td>
            </tr>
            <tr>
               <td class="line-number" value="1010"></td>
               <td class="line-content">            if (ufo) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1011"></td>
               <td class="line-content">                ufo.update();</td>
            </tr>
            <tr>
               <td class="line-number" value="1012"></td>
               <td class="line-content">                if (ufo.isOffScreen()) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1013"></td>
               <td class="line-content">                    ufo = null;</td>
            </tr>
            <tr>
               <td class="line-number" value="1014"></td>
               <td class="line-content">                    stopUFOSound(); // Stop UFO sound</td>
            </tr>
            <tr>
               <td class="line-number" value="1015"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="1016"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1017"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1018"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="1019"></td>
               <td class="line-content">        // Check collisions</td>
            </tr>
            <tr>
               <td class="line-number" value="1020"></td>
               <td class="line-content">        function checkCollisions() {</td>
            </tr>
            <tr>
               <td class="line-number" value="1021"></td>
               <td class="line-content">            // Player bullets vs invaders</td>
            </tr>
            <tr>
               <td class="line-number" value="1022"></td>
               <td class="line-content">            for (let i = bullets.length - 1; i &gt;= 0; i--) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1023"></td>
               <td class="line-content">                for (let j = invaders.length - 1; j &gt;= 0; j--) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1024"></td>
               <td class="line-content">                    if (bullets[i] &amp;&amp; invaders[j] &amp;&amp;</td>
            </tr>
            <tr>
               <td class="line-number" value="1025"></td>
               <td class="line-content">                        bullets[i].x &lt; invaders[j].x + invaders[j].width &amp;&amp;</td>
            </tr>
            <tr>
               <td class="line-number" value="1026"></td>
               <td class="line-content">                        bullets[i].x + bullets[i].width &gt; invaders[j].x &amp;&amp;</td>
            </tr>
            <tr>
               <td class="line-number" value="1027"></td>
               <td class="line-content">                        bullets[i].y &lt; invaders[j].y + invaders[j].height &amp;&amp;</td>
            </tr>
            <tr>
               <td class="line-number" value="1028"></td>
               <td class="line-content">                        bullets[i].y + bullets[i].height &gt; invaders[j].y) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1029"></td>
               <td class="line-content">                        </td>
            </tr>
            <tr>
               <td class="line-number" value="1030"></td>
               <td class="line-content">                        bullets.splice(i, 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="1031"></td>
               <td class="line-content">                        </td>
            </tr>
            <tr>
               <td class="line-number" value="1032"></td>
               <td class="line-content">                        // Check if invader is destroyed</td>
            </tr>
            <tr>
               <td class="line-number" value="1033"></td>
               <td class="line-content">                        if (invaders[j].takeDamage()) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1034"></td>
               <td class="line-content">                            playInvaderDeathSound(invaders[j].stage);</td>
            </tr>
            <tr>
               <td class="line-number" value="1035"></td>
               <td class="line-content">                            invaders.splice(j, 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="1036"></td>
               <td class="line-content">                            score += 10 * currentStage; // More points for higher stages</td>
            </tr>
            <tr>
               <td class="line-number" value="1037"></td>
               <td class="line-content">                        } else {</td>
            </tr>
            <tr>
               <td class="line-number" value="1038"></td>
               <td class="line-content">                            playInvaderHitSound(invaders[j].stage);</td>
            </tr>
            <tr>
               <td class="line-number" value="1039"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1040"></td>
               <td class="line-content">                        </td>
            </tr>
            <tr>
               <td class="line-number" value="1041"></td>
               <td class="line-content">                        updateScoreDisplay();</td>
            </tr>
            <tr>
               <td class="line-number" value="1042"></td>
               <td class="line-content">                        break;</td>
            </tr>
            <tr>
               <td class="line-number" value="1043"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="1044"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="1045"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1046"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1047"></td>
               <td class="line-content">            // Player bullets vs UFO</td>
            </tr>
            <tr>
               <td class="line-number" value="1048"></td>
               <td class="line-content">            if (ufo) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1049"></td>
               <td class="line-content">                for (let i = bullets.length - 1; i &gt;= 0; i--) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1050"></td>
               <td class="line-content">                    if (bullets[i] &amp;&amp;</td>
            </tr>
            <tr>
               <td class="line-number" value="1051"></td>
               <td class="line-content">                        bullets[i].x &lt; ufo.x + ufo.width &amp;&amp;</td>
            </tr>
            <tr>
               <td class="line-number" value="1052"></td>
               <td class="line-content">                        bullets[i].x + bullets[i].width &gt; ufo.x &amp;&amp;</td>
            </tr>
            <tr>
               <td class="line-number" value="1053"></td>
               <td class="line-content">                        bullets[i].y &lt; ufo.y + ufo.height &amp;&amp;</td>
            </tr>
            <tr>
               <td class="line-number" value="1054"></td>
               <td class="line-content">                        bullets[i].y + bullets[i].height &gt; ufo.y) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1055"></td>
               <td class="line-content">                        </td>
            </tr>
            <tr>
               <td class="line-number" value="1056"></td>
               <td class="line-content">                        bullets.splice(i, 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="1057"></td>
               <td class="line-content">                        ufo = null;</td>
            </tr>
            <tr>
               <td class="line-number" value="1058"></td>
               <td class="line-content">                        stopUFOSound(); // Stop UFO sound when destroyed</td>
            </tr>
            <tr>
               <td class="line-number" value="1059"></td>
               <td class="line-content">                        playUFODestroySound(); // Play UFO destruction sound</td>
            </tr>
            <tr>
               <td class="line-number" value="1060"></td>
               <td class="line-content">                        score += 100; // Bonus points for UFO</td>
            </tr>
            <tr>
               <td class="line-number" value="1061"></td>
               <td class="line-content">                        updateScoreDisplay();</td>
            </tr>
            <tr>
               <td class="line-number" value="1062"></td>
               <td class="line-content">                        break;</td>
            </tr>
            <tr>
               <td class="line-number" value="1063"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="1064"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="1065"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1066"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1067"></td>
               <td class="line-content">            // Player bullets vs barriers</td>
            </tr>
            <tr>
               <td class="line-number" value="1068"></td>
               <td class="line-content">            for (let i = bullets.length - 1; i &gt;= 0; i--) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1069"></td>
               <td class="line-content">                if (bullets[i]) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1070"></td>
               <td class="line-content">                    for (let barrier of barriers) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1071"></td>
               <td class="line-content">                        if (barrier.checkCollision(bullets[i].x, bullets[i].y, bullets[i].width, bullets[i].height)) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1072"></td>
               <td class="line-content">                            bullets.splice(i, 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="1073"></td>
               <td class="line-content">                            break;</td>
            </tr>
            <tr>
               <td class="line-number" value="1074"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1075"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="1076"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="1077"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1078"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1079"></td>
               <td class="line-content">            // Invader bullets vs barriers</td>
            </tr>
            <tr>
               <td class="line-number" value="1080"></td>
               <td class="line-content">            for (let i = invaderBullets.length - 1; i &gt;= 0; i--) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1081"></td>
               <td class="line-content">                if (invaderBullets[i]) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1082"></td>
               <td class="line-content">                    for (let barrier of barriers) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1083"></td>
               <td class="line-content">                        if (barrier.checkCollision(invaderBullets[i].x, invaderBullets[i].y, invaderBullets[i].width, invaderBullets[i].height)) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1084"></td>
               <td class="line-content">                            invaderBullets.splice(i, 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="1085"></td>
               <td class="line-content">                            break;</td>
            </tr>
            <tr>
               <td class="line-number" value="1086"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1087"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="1088"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="1089"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1090"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1091"></td>
               <td class="line-content">            // UFO bombs vs barriers</td>
            </tr>
            <tr>
               <td class="line-number" value="1092"></td>
               <td class="line-content">            for (let i = ufoBombs.length - 1; i &gt;= 0; i--) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1093"></td>
               <td class="line-content">                if (ufoBombs[i]) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1094"></td>
               <td class="line-content">                    for (let barrier of barriers) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1095"></td>
               <td class="line-content">                        if (barrier.checkCollision(ufoBombs[i].x, ufoBombs[i].y, ufoBombs[i].width, ufoBombs[i].height)) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1096"></td>
               <td class="line-content">                            // UFO bombs destroy more blocks</td>
            </tr>
            <tr>
               <td class="line-number" value="1097"></td>
               <td class="line-content">                            const centerCol = Math.floor((ufoBombs[i].x + ufoBombs[i].width/2 - barrier.x) / barrier.blockSize);</td>
            </tr>
            <tr>
               <td class="line-number" value="1098"></td>
               <td class="line-content">                            const centerRow = Math.floor((ufoBombs[i].y + ufoBombs[i].height/2 - barrier.y) / barrier.blockSize);</td>
            </tr>
            <tr>
               <td class="line-number" value="1099"></td>
               <td class="line-content">                            barrier.destroyBlocks(centerCol, centerRow, 4); // Larger destruction radius</td>
            </tr>
            <tr>
               <td class="line-number" value="1100"></td>
               <td class="line-content">                            ufoBombs.splice(i, 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="1101"></td>
               <td class="line-content">                            break;</td>
            </tr>
            <tr>
               <td class="line-number" value="1102"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1103"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="1104"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="1105"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1106"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1107"></td>
               <td class="line-content">            // Invader bullets vs player</td>
            </tr>
            <tr>
               <td class="line-number" value="1108"></td>
               <td class="line-content">            for (let i = invaderBullets.length - 1; i &gt;= 0; i--) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1109"></td>
               <td class="line-content">                if (invulnerabilityTimer &lt;= 0 &amp;&amp; // Only check collision if not invulnerable</td>
            </tr>
            <tr>
               <td class="line-number" value="1110"></td>
               <td class="line-content">                    invaderBullets[i].x &lt; player.x + player.width &amp;&amp;</td>
            </tr>
            <tr>
               <td class="line-number" value="1111"></td>
               <td class="line-content">                    invaderBullets[i].x + invaderBullets[i].width &gt; player.x &amp;&amp;</td>
            </tr>
            <tr>
               <td class="line-number" value="1112"></td>
               <td class="line-content">                    invaderBullets[i].y &lt; player.y + player.height &amp;&amp;</td>
            </tr>
            <tr>
               <td class="line-number" value="1113"></td>
               <td class="line-content">                    invaderBullets[i].y + invaderBullets[i].height &gt; player.y) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1114"></td>
               <td class="line-content">                    </td>
            </tr>
            <tr>
               <td class="line-number" value="1115"></td>
               <td class="line-content">                    invaderBullets.splice(i, 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="1116"></td>
               <td class="line-content">                    playerHit();</td>
            </tr>
            <tr>
               <td class="line-number" value="1117"></td>
               <td class="line-content">                    return;</td>
            </tr>
            <tr>
               <td class="line-number" value="1118"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="1119"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1120"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1121"></td>
               <td class="line-content">            // UFO bombs vs player</td>
            </tr>
            <tr>
               <td class="line-number" value="1122"></td>
               <td class="line-content">            for (let i = ufoBombs.length - 1; i &gt;= 0; i--) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1123"></td>
               <td class="line-content">                if (invulnerabilityTimer &lt;= 0 &amp;&amp; // Only check collision if not invulnerable</td>
            </tr>
            <tr>
               <td class="line-number" value="1124"></td>
               <td class="line-content">                    ufoBombs[i].x &lt; player.x + player.width &amp;&amp;</td>
            </tr>
            <tr>
               <td class="line-number" value="1125"></td>
               <td class="line-content">                    ufoBombs[i].x + ufoBombs[i].width &gt; player.x &amp;&amp;</td>
            </tr>
            <tr>
               <td class="line-number" value="1126"></td>
               <td class="line-content">                    ufoBombs[i].y &lt; player.y + player.height &amp;&amp;</td>
            </tr>
            <tr>
               <td class="line-number" value="1127"></td>
               <td class="line-content">                    ufoBombs[i].y + ufoBombs[i].height &gt; player.y) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1128"></td>
               <td class="line-content">                    </td>
            </tr>
            <tr>
               <td class="line-number" value="1129"></td>
               <td class="line-content">                    ufoBombs.splice(i, 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="1130"></td>
               <td class="line-content">                    playerHit();</td>
            </tr>
            <tr>
               <td class="line-number" value="1131"></td>
               <td class="line-content">                    return;</td>
            </tr>
            <tr>
               <td class="line-number" value="1132"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="1133"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1134"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1135"></td>
               <td class="line-content">            // Check if invaders reached player</td>
            </tr>
            <tr>
               <td class="line-number" value="1136"></td>
               <td class="line-content">            for (let invader of invaders) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1137"></td>
               <td class="line-content">                if (invader.y + invader.height &gt;= player.y) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1138"></td>
               <td class="line-content">                    gameOver();</td>
            </tr>
            <tr>
               <td class="line-number" value="1139"></td>
               <td class="line-content">                    return;</td>
            </tr>
            <tr>
               <td class="line-number" value="1140"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="1141"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1142"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1143"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="1144"></td>
               <td class="line-content">        // Update score display</td>
            </tr>
            <tr>
               <td class="line-number" value="1145"></td>
               <td class="line-content">        function updateScoreDisplay() {</td>
            </tr>
            <tr>
               <td class="line-number" value="1146"></td>
               <td class="line-content">            scoreElement.textContent = `Score: ${score} | Stage: ${currentStage} | Lives: ${playerLives}`;</td>
            </tr>
            <tr>
               <td class="line-number" value="1147"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1148"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="1149"></td>
               <td class="line-content">        // Player hit function</td>
            </tr>
            <tr>
               <td class="line-number" value="1150"></td>
               <td class="line-content">        function playerHit() {</td>
            </tr>
            <tr>
               <td class="line-number" value="1151"></td>
               <td class="line-content">            playerLives--;</td>
            </tr>
            <tr>
               <td class="line-number" value="1152"></td>
               <td class="line-content">            invulnerabilityTimer = 120; // 2 seconds of invulnerability at 60fps</td>
            </tr>
            <tr>
               <td class="line-number" value="1153"></td>
               <td class="line-content">            updateScoreDisplay();</td>
            </tr>
            <tr>
               <td class="line-number" value="1154"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1155"></td>
               <td class="line-content">            if (playerLives &lt;= 0) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1156"></td>
               <td class="line-content">                gameOver();</td>
            </tr>
            <tr>
               <td class="line-number" value="1157"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1158"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1159"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="1160"></td>
               <td class="line-content">        // Game over</td>
            </tr>
            <tr>
               <td class="line-number" value="1161"></td>
               <td class="line-content">        function gameOver() {</td>
            </tr>
            <tr>
               <td class="line-number" value="1162"></td>
               <td class="line-content">            gameRunning = false;</td>
            </tr>
            <tr>
               <td class="line-number" value="1163"></td>
               <td class="line-content">            playGameOverSound(); // Play sad game over sound</td>
            </tr>
            <tr>
               <td class="line-number" value="1164"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1165"></td>
               <td class="line-content">            // Check for new record</td>
            </tr>
            <tr>
               <td class="line-number" value="1166"></td>
               <td class="line-content">            if (checkNewRecord(score)) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1167"></td>
               <td class="line-content">                isNewRecord = true;</td>
            </tr>
            <tr>
               <td class="line-number" value="1168"></td>
               <td class="line-content">                newRecordElement.style.display = 'block';</td>
            </tr>
            <tr>
               <td class="line-number" value="1169"></td>
               <td class="line-content">                playerNameInput.value = '';</td>
            </tr>
            <tr>
               <td class="line-number" value="1170"></td>
               <td class="line-content">                playerNameInput.focus();</td>
            </tr>
            <tr>
               <td class="line-number" value="1171"></td>
               <td class="line-content">            } else {</td>
            </tr>
            <tr>
               <td class="line-number" value="1172"></td>
               <td class="line-content">                gameOverElement.style.display = 'block';</td>
            </tr>
            <tr>
               <td class="line-number" value="1173"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1174"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1175"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="1176"></td>
               <td class="line-content">        // Game complete</td>
            </tr>
            <tr>
               <td class="line-number" value="1177"></td>
               <td class="line-content">        function gameComplete() {</td>
            </tr>
            <tr>
               <td class="line-number" value="1178"></td>
               <td class="line-content">            gameRunning = false;</td>
            </tr>
            <tr>
               <td class="line-number" value="1179"></td>
               <td class="line-content">            isGameComplete = true;</td>
            </tr>
            <tr>
               <td class="line-number" value="1180"></td>
               <td class="line-content">            playGameCompleteSound(); // Play victory fanfare</td>
            </tr>
            <tr>
               <td class="line-number" value="1181"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1182"></td>
               <td class="line-content">            // Check for new record</td>
            </tr>
            <tr>
               <td class="line-number" value="1183"></td>
               <td class="line-content">            if (checkNewRecord(score)) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1184"></td>
               <td class="line-content">                isNewRecord = true;</td>
            </tr>
            <tr>
               <td class="line-number" value="1185"></td>
               <td class="line-content">                newRecordElement.style.display = 'block';</td>
            </tr>
            <tr>
               <td class="line-number" value="1186"></td>
               <td class="line-content">                playerNameInput.value = '';</td>
            </tr>
            <tr>
               <td class="line-number" value="1187"></td>
               <td class="line-content">                playerNameInput.focus();</td>
            </tr>
            <tr>
               <td class="line-number" value="1188"></td>
               <td class="line-content">            } else {</td>
            </tr>
            <tr>
               <td class="line-number" value="1189"></td>
               <td class="line-content">                gameCompleteElement.style.display = 'block';</td>
            </tr>
            <tr>
               <td class="line-number" value="1190"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1191"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1192"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="1193"></td>
               <td class="line-content">        // Start game function</td>
            </tr>
            <tr>
               <td class="line-number" value="1194"></td>
               <td class="line-content">        function startGame() {</td>
            </tr>
            <tr>
               <td class="line-number" value="1195"></td>
               <td class="line-content">            initAudio(); // Initialize audio when game starts</td>
            </tr>
            <tr>
               <td class="line-number" value="1196"></td>
               <td class="line-content">            gameStarted = true;</td>
            </tr>
            <tr>
               <td class="line-number" value="1197"></td>
               <td class="line-content">            gameRunning = true;</td>
            </tr>
            <tr>
               <td class="line-number" value="1198"></td>
               <td class="line-content">            startScreenElement.style.display = 'none';</td>
            </tr>
            <tr>
               <td class="line-number" value="1199"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1200"></td>
               <td class="line-content">            // Reset to actual game state</td>
            </tr>
            <tr>
               <td class="line-number" value="1201"></td>
               <td class="line-content">            currentStage = 1;</td>
            </tr>
            <tr>
               <td class="line-number" value="1202"></td>
               <td class="line-content">            score = 0;</td>
            </tr>
            <tr>
               <td class="line-number" value="1203"></td>
               <td class="line-content">            playerLives = 3;</td>
            </tr>
            <tr>
               <td class="line-number" value="1204"></td>
               <td class="line-content">            invulnerabilityTimer = 0;</td>
            </tr>
            <tr>
               <td class="line-number" value="1205"></td>
               <td class="line-content">            updateScoreDisplay();</td>
            </tr>
            <tr>
               <td class="line-number" value="1206"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1207"></td>
               <td class="line-content">            // Reset player position</td>
            </tr>
            <tr>
               <td class="line-number" value="1208"></td>
               <td class="line-content">            player.x = canvas.width / 2 - 25;</td>
            </tr>
            <tr>
               <td class="line-number" value="1209"></td>
               <td class="line-content">            player.y = canvas.height - 60;</td>
            </tr>
            <tr>
               <td class="line-number" value="1210"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1211"></td>
               <td class="line-content">            // Clear arrays</td>
            </tr>
            <tr>
               <td class="line-number" value="1212"></td>
               <td class="line-content">            bullets = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="1213"></td>
               <td class="line-content">            invaderBullets = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="1214"></td>
               <td class="line-content">            ufoBombs = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="1215"></td>
               <td class="line-content">            ufo = null;</td>
            </tr>
            <tr>
               <td class="line-number" value="1216"></td>
               <td class="line-content">            stopUFOSound();</td>
            </tr>
            <tr>
               <td class="line-number" value="1217"></td>
               <td class="line-content">            ufoSpawnTimer = Math.random() * 1000 + 500;</td>
            </tr>
            <tr>
               <td class="line-number" value="1218"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1219"></td>
               <td class="line-content">            // Create actual game invaders and barriers</td>
            </tr>
            <tr>
               <td class="line-number" value="1220"></td>
               <td class="line-content">            createInvaders();</td>
            </tr>
            <tr>
               <td class="line-number" value="1221"></td>
               <td class="line-content">            createBarriers();</td>
            </tr>
            <tr>
               <td class="line-number" value="1222"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1223"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="1224"></td>
               <td class="line-content">        // Restart game</td>
            </tr>
            <tr>
               <td class="line-number" value="1225"></td>
               <td class="line-content">        function restartGame() {</td>
            </tr>
            <tr>
               <td class="line-number" value="1226"></td>
               <td class="line-content">            gameRunning = true;</td>
            </tr>
            <tr>
               <td class="line-number" value="1227"></td>
               <td class="line-content">            isGameComplete = false;</td>
            </tr>
            <tr>
               <td class="line-number" value="1228"></td>
               <td class="line-content">            isNewRecord = false;</td>
            </tr>
            <tr>
               <td class="line-number" value="1229"></td>
               <td class="line-content">            score = 0;</td>
            </tr>
            <tr>
               <td class="line-number" value="1230"></td>
               <td class="line-content">            currentStage = 1;</td>
            </tr>
            <tr>
               <td class="line-number" value="1231"></td>
               <td class="line-content">            playerLives = 3;</td>
            </tr>
            <tr>
               <td class="line-number" value="1232"></td>
               <td class="line-content">            invulnerabilityTimer = 0;</td>
            </tr>
            <tr>
               <td class="line-number" value="1233"></td>
               <td class="line-content">            updateScoreDisplay();</td>
            </tr>
            <tr>
               <td class="line-number" value="1234"></td>
               <td class="line-content">            gameOverElement.style.display = 'none';</td>
            </tr>
            <tr>
               <td class="line-number" value="1235"></td>
               <td class="line-content">            gameCompleteElement.style.display = 'none';</td>
            </tr>
            <tr>
               <td class="line-number" value="1236"></td>
               <td class="line-content">            newRecordElement.style.display = 'none';</td>
            </tr>
            <tr>
               <td class="line-number" value="1237"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1238"></td>
               <td class="line-content">            // Reset player position</td>
            </tr>
            <tr>
               <td class="line-number" value="1239"></td>
               <td class="line-content">            player.x = canvas.width / 2 - 25;</td>
            </tr>
            <tr>
               <td class="line-number" value="1240"></td>
               <td class="line-content">            player.y = canvas.height - 60;</td>
            </tr>
            <tr>
               <td class="line-number" value="1241"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1242"></td>
               <td class="line-content">            // Clear arrays</td>
            </tr>
            <tr>
               <td class="line-number" value="1243"></td>
               <td class="line-content">            bullets = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="1244"></td>
               <td class="line-content">            invaderBullets = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="1245"></td>
               <td class="line-content">            ufoBombs = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="1246"></td>
               <td class="line-content">            ufo = null;</td>
            </tr>
            <tr>
               <td class="line-number" value="1247"></td>
               <td class="line-content">            stopUFOSound();</td>
            </tr>
            <tr>
               <td class="line-number" value="1248"></td>
               <td class="line-content">            ufoSpawnTimer = Math.random() * 1000 + 500;</td>
            </tr>
            <tr>
               <td class="line-number" value="1249"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1250"></td>
               <td class="line-content">            // Recreate invaders and barriers</td>
            </tr>
            <tr>
               <td class="line-number" value="1251"></td>
               <td class="line-content">            createInvaders();</td>
            </tr>
            <tr>
               <td class="line-number" value="1252"></td>
               <td class="line-content">            createBarriers();</td>
            </tr>
            <tr>
               <td class="line-number" value="1253"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1254"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="1255"></td>
               <td class="line-content">        // Draw everything</td>
            </tr>
            <tr>
               <td class="line-number" value="1256"></td>
               <td class="line-content">        function draw() {</td>
            </tr>
            <tr>
               <td class="line-number" value="1257"></td>
               <td class="line-content">            // Clear canvas</td>
            </tr>
            <tr>
               <td class="line-number" value="1258"></td>
               <td class="line-content">            ctx.fillStyle = '#000';</td>
            </tr>
            <tr>
               <td class="line-number" value="1259"></td>
               <td class="line-content">            ctx.fillRect(0, 0, canvas.width, canvas.height);</td>
            </tr>
            <tr>
               <td class="line-number" value="1260"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1261"></td>
               <td class="line-content">            // Draw stars background</td>
            </tr>
            <tr>
               <td class="line-number" value="1262"></td>
               <td class="line-content">            ctx.fillStyle = '#fff';</td>
            </tr>
            <tr>
               <td class="line-number" value="1263"></td>
               <td class="line-content">            for (let i = 0; i &lt; 50; i++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1264"></td>
               <td class="line-content">                let x = (i * 37) % canvas.width;</td>
            </tr>
            <tr>
               <td class="line-number" value="1265"></td>
               <td class="line-content">                let y = (i * 23) % canvas.height;</td>
            </tr>
            <tr>
               <td class="line-number" value="1266"></td>
               <td class="line-content">                ctx.fillRect(x, y, 1, 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="1267"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1268"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1269"></td>
               <td class="line-content">            if (!gameStarted) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1270"></td>
               <td class="line-content">                // Draw preview screen</td>
            </tr>
            <tr>
               <td class="line-number" value="1271"></td>
               <td class="line-content">                drawPreviewScreen();</td>
            </tr>
            <tr>
               <td class="line-number" value="1272"></td>
               <td class="line-content">            } else {</td>
            </tr>
            <tr>
               <td class="line-number" value="1273"></td>
               <td class="line-content">                // Draw actual game</td>
            </tr>
            <tr>
               <td class="line-number" value="1274"></td>
               <td class="line-content">                drawPlayer();</td>
            </tr>
            <tr>
               <td class="line-number" value="1275"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="1276"></td>
               <td class="line-content">                bullets.forEach(bullet =&gt; bullet.draw());</td>
            </tr>
            <tr>
               <td class="line-number" value="1277"></td>
               <td class="line-content">                invaderBullets.forEach(bullet =&gt; bullet.draw());</td>
            </tr>
            <tr>
               <td class="line-number" value="1278"></td>
               <td class="line-content">                ufoBombs.forEach(bomb =&gt; bomb.draw());</td>
            </tr>
            <tr>
               <td class="line-number" value="1279"></td>
               <td class="line-content">                invaders.forEach(invader =&gt; invader.draw());</td>
            </tr>
            <tr>
               <td class="line-number" value="1280"></td>
               <td class="line-content">                barriers.forEach(barrier =&gt; barrier.draw());</td>
            </tr>
            <tr>
               <td class="line-number" value="1281"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="1282"></td>
               <td class="line-content">                // Draw UFO if it exists</td>
            </tr>
            <tr>
               <td class="line-number" value="1283"></td>
               <td class="line-content">                if (ufo) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1284"></td>
               <td class="line-content">                    ufo.draw();</td>
            </tr>
            <tr>
               <td class="line-number" value="1285"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="1286"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="1287"></td>
               <td class="line-content">                // Draw lives indicator</td>
            </tr>
            <tr>
               <td class="line-number" value="1288"></td>
               <td class="line-content">                ctx.fillStyle = '#00ff00';</td>
            </tr>
            <tr>
               <td class="line-number" value="1289"></td>
               <td class="line-content">                ctx.font = '16px Courier New';</td>
            </tr>
            <tr>
               <td class="line-number" value="1290"></td>
               <td class="line-content">                for (let i = 0; i &lt; playerLives; i++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1291"></td>
               <td class="line-content">                    ctx.fillText('♦', 20 + i * 25, canvas.height - 20);</td>
            </tr>
            <tr>
               <td class="line-number" value="1292"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="1293"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1294"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1295"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="1296"></td>
               <td class="line-content">        // Draw preview screen</td>
            </tr>
            <tr>
               <td class="line-number" value="1297"></td>
               <td class="line-content">        function drawPreviewScreen() {</td>
            </tr>
            <tr>
               <td class="line-number" value="1298"></td>
               <td class="line-content">            // Draw preview invaders (static, no movement)</td>
            </tr>
            <tr>
               <td class="line-number" value="1299"></td>
               <td class="line-content">            const previewInvaders = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="1300"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1301"></td>
               <td class="line-content">            switch(previewStage) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1302"></td>
               <td class="line-content">                case 1:</td>
            </tr>
            <tr>
               <td class="line-number" value="1303"></td>
               <td class="line-content">                    for (let row = 0; row &lt; 3; row++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1304"></td>
               <td class="line-content">                        for (let col = 0; col &lt; 10; col++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1305"></td>
               <td class="line-content">                            previewInvaders.push(new Invader(col * 60 + 50, row * 50 + 100, 1));</td>
            </tr>
            <tr>
               <td class="line-number" value="1306"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1307"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="1308"></td>
               <td class="line-content">                    break;</td>
            </tr>
            <tr>
               <td class="line-number" value="1309"></td>
               <td class="line-content">                case 2:</td>
            </tr>
            <tr>
               <td class="line-number" value="1310"></td>
               <td class="line-content">                    for (let row = 0; row &lt; 4; row++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1311"></td>
               <td class="line-content">                        for (let col = 0; col &lt; 8; col++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1312"></td>
               <td class="line-content">                            previewInvaders.push(new Invader(col * 80 + 60, row * 60 + 80, 2));</td>
            </tr>
            <tr>
               <td class="line-number" value="1313"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1314"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="1315"></td>
               <td class="line-content">                    break;</td>
            </tr>
            <tr>
               <td class="line-number" value="1316"></td>
               <td class="line-content">                case 3:</td>
            </tr>
            <tr>
               <td class="line-number" value="1317"></td>
               <td class="line-content">                    for (let row = 0; row &lt; 2; row++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1318"></td>
               <td class="line-content">                        for (let col = 0; col &lt; 2; col++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1319"></td>
               <td class="line-content">                            previewInvaders.push(new Invader(col * 200 + 200, row * 100 + 120, 3));</td>
            </tr>
            <tr>
               <td class="line-number" value="1320"></td>
               <td class="line-content">                        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1321"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="1322"></td>
               <td class="line-content">                    break;</td>
            </tr>
            <tr>
               <td class="line-number" value="1323"></td>
               <td class="line-content">                case 4:</td>
            </tr>
            <tr>
               <td class="line-number" value="1324"></td>
               <td class="line-content">                    previewInvaders.push(new Invader(canvas.width/2 - 60, 150, 4));</td>
            </tr>
            <tr>
               <td class="line-number" value="1325"></td>
               <td class="line-content">                    break;</td>
            </tr>
            <tr>
               <td class="line-number" value="1326"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1327"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1328"></td>
               <td class="line-content">            // Draw preview invaders</td>
            </tr>
            <tr>
               <td class="line-number" value="1329"></td>
               <td class="line-content">            previewInvaders.forEach(invader =&gt; invader.draw());</td>
            </tr>
            <tr>
               <td class="line-number" value="1330"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1331"></td>
               <td class="line-content">            // Draw preview barriers</td>
            </tr>
            <tr>
               <td class="line-number" value="1332"></td>
               <td class="line-content">            const previewBarriers = [];</td>
            </tr>
            <tr>
               <td class="line-number" value="1333"></td>
               <td class="line-content">            const barrierCount = 4;</td>
            </tr>
            <tr>
               <td class="line-number" value="1334"></td>
               <td class="line-content">            const barrierSpacing = canvas.width / (barrierCount + 1);</td>
            </tr>
            <tr>
               <td class="line-number" value="1335"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1336"></td>
               <td class="line-content">            for (let i = 0; i &lt; barrierCount; i++) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1337"></td>
               <td class="line-content">                const x = barrierSpacing * (i + 1) - 40;</td>
            </tr>
            <tr>
               <td class="line-number" value="1338"></td>
               <td class="line-content">                const y = canvas.height - 200;</td>
            </tr>
            <tr>
               <td class="line-number" value="1339"></td>
               <td class="line-content">                previewBarriers.push(new Barrier(x, y));</td>
            </tr>
            <tr>
               <td class="line-number" value="1340"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1341"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1342"></td>
               <td class="line-content">            previewBarriers.forEach(barrier =&gt; barrier.draw());</td>
            </tr>
            <tr>
               <td class="line-number" value="1343"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1344"></td>
               <td class="line-content">            // Draw preview player</td>
            </tr>
            <tr>
               <td class="line-number" value="1345"></td>
               <td class="line-content">            ctx.fillStyle = '#00ff00';</td>
            </tr>
            <tr>
               <td class="line-number" value="1346"></td>
               <td class="line-content">            const previewPlayerX = canvas.width / 2 - 25;</td>
            </tr>
            <tr>
               <td class="line-number" value="1347"></td>
               <td class="line-content">            const previewPlayerY = canvas.height - 60;</td>
            </tr>
            <tr>
               <td class="line-number" value="1348"></td>
               <td class="line-content">            ctx.fillRect(previewPlayerX, previewPlayerY, 50, 30);</td>
            </tr>
            <tr>
               <td class="line-number" value="1349"></td>
               <td class="line-content">            ctx.fillRect(previewPlayerX + 22, previewPlayerY - 10, 6, 10);</td>
            </tr>
            <tr>
               <td class="line-number" value="1350"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1351"></td>
               <td class="line-content">            // Draw stage title</td>
            </tr>
            <tr>
               <td class="line-number" value="1352"></td>
               <td class="line-content">            ctx.fillStyle = '#ffff00';</td>
            </tr>
            <tr>
               <td class="line-number" value="1353"></td>
               <td class="line-content">            ctx.font = '32px Courier New';</td>
            </tr>
            <tr>
               <td class="line-number" value="1354"></td>
               <td class="line-content">            ctx.textAlign = 'center';</td>
            </tr>
            <tr>
               <td class="line-number" value="1355"></td>
               <td class="line-content">            ctx.fillText(`STAGE ${previewStage} PREVIEW`, canvas.width/2, 50);</td>
            </tr>
            <tr>
               <td class="line-number" value="1356"></td>
               <td class="line-content">            ctx.textAlign = 'left';</td>
            </tr>
            <tr>
               <td class="line-number" value="1357"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1358"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="1359"></td>
               <td class="line-content">        // Main game loop</td>
            </tr>
            <tr>
               <td class="line-number" value="1360"></td>
               <td class="line-content">        function gameLoop() {</td>
            </tr>
            <tr>
               <td class="line-number" value="1361"></td>
               <td class="line-content">            if (gameRunning) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1362"></td>
               <td class="line-content">                updatePlayer();</td>
            </tr>
            <tr>
               <td class="line-number" value="1363"></td>
               <td class="line-content">                updateBullets();</td>
            </tr>
            <tr>
               <td class="line-number" value="1364"></td>
               <td class="line-content">                updateInvaders();</td>
            </tr>
            <tr>
               <td class="line-number" value="1365"></td>
               <td class="line-content">                updateUFO();</td>
            </tr>
            <tr>
               <td class="line-number" value="1366"></td>
               <td class="line-content">                checkCollisions();</td>
            </tr>
            <tr>
               <td class="line-number" value="1367"></td>
               <td class="line-content">                </td>
            </tr>
            <tr>
               <td class="line-number" value="1368"></td>
               <td class="line-content">                // Check win condition</td>
            </tr>
            <tr>
               <td class="line-number" value="1369"></td>
               <td class="line-content">                if (invaders.length === 0) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1370"></td>
               <td class="line-content">                    if (currentStage &lt; 4) {</td>
            </tr>
            <tr>
               <td class="line-number" value="1371"></td>
               <td class="line-content">                        // Advance to next stage</td>
            </tr>
            <tr>
               <td class="line-number" value="1372"></td>
               <td class="line-content">                        playStageClearSound(); // Play stage clear sound</td>
            </tr>
            <tr>
               <td class="line-number" value="1373"></td>
               <td class="line-content">                        currentStage++;</td>
            </tr>
            <tr>
               <td class="line-number" value="1374"></td>
               <td class="line-content">                        createInvaders();</td>
            </tr>
            <tr>
               <td class="line-number" value="1375"></td>
               <td class="line-content">                        createBarriers(); // Reset barriers for new stage</td>
            </tr>
            <tr>
               <td class="line-number" value="1376"></td>
               <td class="line-content">                        updateScoreDisplay();</td>
            </tr>
            <tr>
               <td class="line-number" value="1377"></td>
               <td class="line-content">                    } else {</td>
            </tr>
            <tr>
               <td class="line-number" value="1378"></td>
               <td class="line-content">                        // Game complete!</td>
            </tr>
            <tr>
               <td class="line-number" value="1379"></td>
               <td class="line-content">                        gameComplete();</td>
            </tr>
            <tr>
               <td class="line-number" value="1380"></td>
               <td class="line-content">                    }</td>
            </tr>
            <tr>
               <td class="line-number" value="1381"></td>
               <td class="line-content">                }</td>
            </tr>
            <tr>
               <td class="line-number" value="1382"></td>
               <td class="line-content">            }</td>
            </tr>
            <tr>
               <td class="line-number" value="1383"></td>
               <td class="line-content">            </td>
            </tr>
            <tr>
               <td class="line-number" value="1384"></td>
               <td class="line-content">            draw();</td>
            </tr>
            <tr>
               <td class="line-number" value="1385"></td>
               <td class="line-content">            requestAnimationFrame(gameLoop);</td>
            </tr>
            <tr>
               <td class="line-number" value="1386"></td>
               <td class="line-content">        }</td>
            </tr>
            <tr>
               <td class="line-number" value="1387"></td>
               <td class="line-content"><br></td>
            </tr>
            <tr>
               <td class="line-number" value="1388"></td>
               <td class="line-content">        // Initialize and start game</td>
            </tr>
            <tr>
               <td class="line-number" value="1389"></td>
               <td class="line-content">        loadRankings(); // Load rankings on startup</td>
            </tr>
            <tr>
               <td class="line-number" value="1390"></td>
               <td class="line-content">        createInvaders(previewStage); // Create preview invaders</td>
            </tr>
            <tr>
               <td class="line-number" value="1391"></td>
               <td class="line-content">        createBarriers(); // Create preview barriers</td>
            </tr>
            <tr>
               <td class="line-number" value="1392"></td>
               <td class="line-content">        gameLoop();</td>
            </tr>
            <tr>
               <td class="line-number" value="1393"></td>
               <td class="line-content">    <span class="html-tag">&lt;/script&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="1394"></td>
               <td class="line-content"><span class="html-tag">&lt;/body&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="1395"></td>
               <td class="line-content"><span class="html-tag">&lt;/html&gt;</span></td>
            </tr>
            <tr>
               <td class="line-number" value="1396"></td>
               <td class="line-content"><span class="html-end-of-file"></span></td>
            </tr>
         </tbody>
      </table>
   </body>
</html>
